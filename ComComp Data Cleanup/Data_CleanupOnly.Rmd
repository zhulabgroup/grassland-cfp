---
title: "Data Cleanup"
output: word_document
---

In case of problems with connecting to GitHub:
rm -f .git/index
git rest

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(plotrix)
```

# Data Import and Rough Cleanup

This code cleans and compiles 10 datasets I am using for my grassland community analyses.

## Angelo
These data were collected by K.B. Suttle from 2002 to 2015.  

```{r Angelo Data Import and Clean, echo= FALSE}
Angelo <- read.csv("ComComp Data Cleanup/Angelo/Angelo_CommCompData.csv") %>%
  filter(TMT == "C") %>%
  gather("Dan":"Thistle", key = species, value = cover)
names(Angelo) <- tolower(names(Angelo))

Angelo_spp <- read.csv("ComComp Data Cleanup/Angelo/Angelo_spp_guilds.csv")

Angelo <- left_join(Angelo, Angelo_spp, by = "species") %>%
  mutate(Site = "Angelo") %>%
  filter(cover > 0)

angelo_data <- Angelo %>%
  select("tmt", "plot", "year", "species.name", "cover", "guild") %>%
  mutate(site = "Angelo") %>%
  filter(guild != "Bare",
           guild != "Moss",
           guild != "Litter")

## checking species and guilds match up
Angelo_spp_check <- angelo_data  %>%
  group_by(species.name, guild) %>%
  summarise(mean = mean(cover))


unique(angelo_data$species.name)
unique(angelo_data$guild)

remove(Angelo)
remove(Angelo_spp)
remove(Angelo_spp_check)
```


## Carrizo
This data represents Carrizo, from 2007 to 2018. The data are taken in plots, with a variable number of plots measured annually. However, for each plot, 81 pin drops (9x9 frame) were used to assess the community structure of the site. 

In the raw data, there should be be 8 1x1m plots per site (e.g. EP1, EP2) and ten of those sites per Site.Type (EP, SC) through 2014. After 2015 that level of replication decreases to 4 sites per Site.Type. This reduction is due to the addition of a new experiment involving precipitation that some plots were cannibalized for. 

**At a later date, we may want to consider changing the level of analysis. For now, I will treat each plot as a separate replicate.**

```{r Import & clean Carrizo, include=FALSE}

## importing all of the files
carrizo_spp <- read.csv("ComComp Data Cleanup/Carrizo/Carrizo_plant list.csv")
carrizo <- read.csv("ComComp Data Cleanup/Carrizo/Carrizo_data.csv")
carrizo_forms <- read.csv("ComComp Data Cleanup/Carrizo/Carrizo_plant forms.csv")
carrizo_extras <- read.csv("ComComp Data Cleanup/Carrizo/carrizo_extraspecies.csv")

carrizo$Plot <- as.factor(carrizo$Plot)
str(carrizo)

## renaming some columns and selecting only the columns we care about
carrizo <- carrizo %>%
  rename(Intercepts = Count) %>%
  select(Site, Plot, Site.type, year, Intercepts, Code)
carrizo$Code <- tolower(carrizo$Code)

## combining the species guild info to the main data
carrizo_spp <- left_join(carrizo_spp, carrizo_forms, by = "newform")
carrizo_spp <- carrizo_spp %>%
  select(NewCode, SCIENTIFIC.NAME, nat.exo, ann.per, lifeform, guild) %>%
  rename(Code = NewCode,
         Species.Name = SCIENTIFIC.NAME)
carrizo_spp <- full_join(carrizo_spp, carrizo_extras, by = c("Code", "Species.Name", "nat.exo", "ann.per", "lifeform", "guild"))

## adding the missing guild info (for things like "moss" and "bare"), getting rid of a very small number of NA datapoints, and adding a "site" column.
carrizo_data <- left_join(carrizo, carrizo_spp, by = "Code")
carrizo_data <- carrizo_data %>%
  filter(!is.na(Intercepts),
         Intercepts > 0,
         !is.na(guild)) %>%
  mutate(Site = "Carrizo")

unique(carrizo_data$Species.Name)
unique(carrizo_data$guild)


## checking species and guilds match up
Carrizo_spp_check <- carrizo_data  %>%
  group_by(Species.Name, guild) %>%
  summarise(mean = mean(Intercepts))

## There are a small number of unidentified species (*remember to check the number of NA guilds*), so I have simply omitted them from the dataset. 

## Removing extra carrizo objects
remove(carrizo)
remove(carrizo_extras)
remove(carrizo_forms)
remove(carrizo_spp)
remove(Carrizo_spp_check)
remove(carrizo_rich)
```


## Elkhorn
Data for grassland plots at Elkhorn Slough. Data were collected by Karen Holl and Grey Hayes between 1999 and 2018. For these analyses, I am using on the control plots (n=3), and removing all other treatments from the dataset. *Karen has suggested combining all of the Bromus species into one group*. 

Note that most of the code in the cleanup process was written before transitioning to R markdown and GitHub. 

```{r Importing Elkhorn, warning=FALSE, echo=FALSE}
setwd("HollData")

elkspp <- read.csv("ComComp Data Cleanup/HollData/ElkhornSpecies.csv")
elkspp$species.code <- tolower(elkspp$species.code)

elk_guilds <- read.csv("ComComp Data Cleanup/HollData/ElkhornGuilds.csv")
elk99 <- read.csv("ComComp Data Cleanup/HollData/Elk_1999.csv",  skip = 4)
elk00 <- read.csv("ComComp Data Cleanup/HollData/Elk_2000.csv", skip = 3)
elk01 <- read.csv("ComComp Data Cleanup/HollData/Elk_2001.csv", skip = 3)
elk02 <- read.csv("ComComp Data Cleanup/HollData/Elk_2002.csv", skip = 3)
elk03 <- read.csv("ComComp Data Cleanup/HollData/Elk_2003.csv")
elk04 <- read.csv("ComComp Data Cleanup/HollData/Elk_2004.csv")
elk05 <- read.csv("ComComp Data Cleanup/HollData/Elk_2005.csv")
elk06 <- read.csv("ComComp Data Cleanup/HollData/Elk_2006.csv")
elk07 <- read.csv("ComComp Data Cleanup/HollData/Elk_2007.csv")
elk08 <- read.csv("ComComp Data Cleanup/HollData/Elk_2008.csv")
elk09 <- read.csv("ComComp Data Cleanup/HollData/Elk_2009.csv")
elk10 <- read.csv("ComComp Data Cleanup/HollData/Elk_2010.csv", skip = 1)
elk11 <- read.csv("ComComp Data Cleanup/HollData/Elk_2011.csv")
elk12 <- read.csv("ComComp Data Cleanup/HollData/Elk_2012.csv")
elk13 <- read.csv("ComComp Data Cleanup/HollData/Elk_2013.csv", skip = 2)
elk14 <- read.csv("ComComp Data Cleanup/HollData/Elk_2014.csv", skip = 1)
elk15 <- read.csv("ComComp Data Cleanup/HollData/Elk_2015.csv", skip = 1)
elk16 <- read.csv("ComComp Data Cleanup/HollData/Elk_2016.csv", skip = 1)
elk17 <- read.csv("ComComp Data Cleanup/HollData/Elk_2017.csv", skip = 1)
elk18 <- read.csv("ComComp Data Cleanup/HollData/Elk_2018.csv", skip = 1)

```

Because these data are in separate files (one year per file), I need to clean the data and compile all of the years into a single object. To clean the data, I selected only the Elkhorn plots (these files also contained the data from two other sites; UCSC and Swanton, removed the non-control plots, restructured the data to make sure only non-zero datapoints were included, and added the year.

I then combined the file with species guild information to each yearly object. 

```{r Cleaning Elkhorn, warning=FALSE, echo=FALSE}
elk99 <- elk99 %>%
  filter(freq == "con",
         site == "elk") %>%
  mutate(year = "1999")
elk99 <- gather(elk99, "anaarv9":"bare9", key = "species.code", value = "intercepts")
elk99$species.code <- substr(elk99$species.code, 1, nchar(elk99$species.code)-1) 
elk99$species.code <- tolower(elk99$species.code)
elk99 <- left_join(elk99, elkspp, by = "species.code")
elk99$intercepts <- as.numeric(elk99$intercepts)

elk00 <- elk00 %>%
  filter(site == "elk",
         freq == "con") %>%
  select(site:naspul) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"naspul", key = "species.code", value = "intercepts") %>%
  mutate(year = "2000")
elk00$species.code <- tolower(elk00$species.code)
elk00 <- left_join(elk00, elkspp, by = "species.code")
elk00 <- spread(elk00, key = plot, value = intercepts) %>%
  rename(plot1 = "1", 
         plot2 = "2",
         plot3 = "3",
         plot4 = "4") %>%
  mutate(intercepts = (plot1 + plot2 + plot3 + plot4)) %>%
  select(-plot1, -plot2, -plot3, -plot4)
elk00$intercepts <- as.numeric(elk00$intercepts)

elk01 <- elk01 %>%
  filter(site == "elk",
         freq == "con") %>%
  select(site:thatch) %>%
  replace(is.na(.), 0) %>%
  gather("anaarv":"thatch", key = "species.code", value = "intercepts") %>%
  mutate(year = "2001")
elk01$species.code <- tolower(elk01$species.code)
elk01 <- left_join(elk01, elkspp, by = "species.code")
elk01 <- spread(elk01, key = plot, value = intercepts) %>%
  rename(plot1 = "1", 
         plot2 = "2",
         plot3 = "3",
         plot4 = "4") %>%
  mutate(intercepts = (plot1 + plot2 + plot3 + plot4)) %>%
  select(-plot1, -plot2, -plot3, -plot4)
elk01$intercepts <- as.numeric(elk01$intercepts)

elk02 <- elk02 %>%
  filter(Site == "elk",
         Frequency == "con") %>%
  select(Site:thatch) %>%
  replace(is.na(.), 0) %>%
  gather("anaarv":"thatch", key = "species.code", value = "intercepts") %>%
  mutate(year = "2002")
names(elk02) <- tolower(names(elk02))
elk02 <- elk02 %>%
  rename(site = site,
         freq = frequency,
         treat = treatment,
         rep = replicate) 
elk02$intercepts <- as.numeric(elk02$intercepts)
elk02 <- left_join(elk02, elkspp, by = "species.code")

elk03 <- elk03 %>%
  filter(SITE == "elk",
         FREQ == "con") %>%
  select(SITE:vulpsp) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"vulpsp", key = "species.code", value = "intercepts") %>%
  mutate(year = "2003")
names(elk03) <- tolower(names(elk03))
elk03 <- left_join(elk03, elkspp, by = "species.code")

elk04 <- elk04 %>%
  filter(SITE == "elk",
         FREQ == "con") %>%
  select(SITE:vulpsp) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"vulpsp", key = "species.code", value = "intercepts") %>%
  mutate(year = "2004") 
names(elk04) <- tolower(names(elk04))
elk04 <- left_join(elk04, elkspp, by = "species.code")

elk05 <- elk05 %>%
  filter(SITE == "elk",
         FREQ == "con") %>%
  select(SITE:vulpsp) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"vulpsp", key = "species.code", value = "intercepts") %>%
  mutate(year = "2005")
names(elk05) <- tolower(names(elk05))
elk05 <- left_join(elk05, elkspp, by = "species.code")

elk06 <- elk06 %>%
  filter(SITE == "elk",
         FREQ == "con") %>%
  select(SITE:vulpsp) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"vulpsp", key = "species.code", value = "intercepts") %>%
  mutate(year = "2006")
names(elk06) <- tolower(names(elk06))
elk06 <- left_join(elk06, elkspp, by = "species.code")

elk07 <- elk07 %>%
  filter(SITE == "elk",
         FREQ == "con") %>%
  select(SITE:vulpsp) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"vulpsp", key = "species.code", value = "intercepts") %>%
  mutate(year = "2007")
names(elk07) <- tolower(names(elk07))
elk07 <- left_join(elk07, elkspp, by = "species.code")

elk08 <- elk08 %>%
  filter(SITE == "elk",
         FREQ == "con") %>%
  select(SITE:hormur) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"hormur", key = "species.code", value = "intercepts") %>%
  mutate(year = "2008")
names(elk08) <- tolower(names(elk08))
elk08 <- left_join(elk08, elkspp, by = "species.code")

elk09 <- elk09 %>%
  filter(SITE == "elk",
         FREQ == "CONTROL") %>%
  select(SITE:vulpsp, -Comments) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"vulpsp", key = "species.code", value = "intercepts") %>%
  mutate(year = "2009")
names(elk09) <- tolower(names(elk09))
elk09 <- left_join(elk09, elkspp, by = "species.code")

elk10 <- elk10 %>%
  filter(SITE == "elk",
         FREQ == "CONTROL") %>%
  select(SITE:vulpsp, -Comments) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"vulpsp", key = "species.code", value = "intercepts") %>%
  mutate(year = "2010")
names(elk10) <- tolower(names(elk10))
elk10$intercepts <- as.numeric(elk10$intercepts)
elk10 <- left_join(elk10, elkspp, by = "species.code")

elk11 <- elk11 %>%
  filter(SITE == "elk",
         FREQ == "CONTROL") %>%
  select(SITE:vulpsp, -Comments) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"vulpsp", key = "species.code", value = "intercepts") %>%
  mutate(year = "2011")
names(elk11) <- tolower(names(elk11))
elk11$intercepts <- as.numeric(elk11$intercepts)
elk11 <- left_join(elk11, elkspp, by = "species.code")

elk12 <- elk12 %>%
  filter(SITE == "elk",
         FREQ == "CONTROL") %>%
  select(SITE:vulpsp, -Comments) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"vulpsp", key = "species.code", value = "intercepts") %>%
  mutate(year = "2012")
names(elk12) <- tolower(names(elk12))
elk12$intercepts <- as.numeric(elk12$intercepts)
elk12 <- left_join(elk12, elkspp, by = "species.code")

elk13 <- elk13 %>%
  filter(SITE == "elk",
         FREQ == "CONTROL") %>%
  select(SITE:vulpsp, -Comments) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"vulpsp", key = "species.code", value = "intercepts") %>%
  mutate(year = "2013")
names(elk13) <- tolower(names(elk13))
elk13$intercepts <- as.numeric(elk13$intercepts)
elk13 <- left_join(elk13, elkspp, by = "species.code")

elk14 <- elk14 %>%
  filter(SITE == "elk",
         FREQ == "CONTROL") %>%
  select(SITE:vulpsp, -Comments) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"vulpsp", key = "species.code", value = "intercepts") %>%
  mutate(year = "2014")
names(elk14) <- tolower(names(elk14))
elk14 <- left_join(elk14, elkspp, by = "species.code")

elk15 <- elk15 %>%
  filter(SITE == "elk",
         FREQ == "CONTROL") %>%
  select(SITE:vulpsp, -Comments) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"vulpsp", key = "species.code", value = "intercepts") %>%
  mutate(year = "2015")
names(elk15) <- tolower(names(elk15))
elk15 <- left_join(elk15, elkspp, by = "species.code")

elk16 <- elk16 %>%
  filter(SITE == "elk",
         FREQ == "CONTROL") %>%
  select(SITE:vulpia) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"vulpia", key = "species.code", value = "intercepts") %>%
  mutate(year = "2016")
names(elk16) <- tolower(names(elk16))
elk16 <- left_join(elk16, elkspp, by = "species.code")

elk17 <- elk17 %>%
  filter(SITE == "elk",
         FREQ == "CONTROL") %>%
  select(SITE:vulpia) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"vulpia", key = "species.code", value = "intercepts") %>%
  mutate(year = "2017")
names(elk17) <- tolower(names(elk17))
elk17 <- left_join(elk17, elkspp, by = "species.code")


elk18 <- elk18 %>%
  filter(SITE == "elk",
         FREQ == "CONTROL") %>%
  select(SITE:vulpia) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"vulpia", key = "species.code", value = "intercepts") %>%
  mutate(year = "2018")
names(elk18) <- tolower(names(elk18))
elk18 <- left_join(elk18, elkspp, by = "species.code")

```

At this point, all that is left to do is to combine the objects so that we have one large object with each year of data in it. 

```{r Compiling Elkhorn, warning=FALSE, echo=FALSE}
elk_99_00 <- full_join(elk99, elk00, by = c("site", "freq", "treat", "rep", "year",
                                          "species.code", "species.name", "guild",
                                          "nat.exo", "ann.perr", "lifeform",
                                          "intercepts"))

elk_99_01 <- full_join(elk_99_00, elk01, by = c("site", "freq", "treat", "rep", "year",
                                          "species.code", "species.name", "guild",
                                          "nat.exo", "ann.perr", "lifeform",
                                          "intercepts"))
remove(elk_99_00)

elk_99_02 <- full_join(elk_99_01, elk02, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(elk_99_01)

elk_99_03 <- full_join(elk_99_02, elk03, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(elk_99_02)

elk_99_04 <- full_join(elk_99_03, elk04, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(elk_99_03)

elk_99_05 <- full_join(elk_99_04, elk05, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(elk_99_04)

elk_99_06 <- full_join(elk_99_05, elk06, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(elk_99_05)

elk_99_07 <- full_join(elk_99_06, elk07, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(elk_99_06)

elk_99_08 <- full_join(elk_99_07, elk08, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(elk_99_07)

elk_99_09 <- full_join(elk_99_08, elk09, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(elk_99_08)

elk_99_10 <- full_join(elk_99_09, elk10, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(elk_99_09)

elk_99_11 <- full_join(elk_99_10, elk11, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(elk_99_10)

elk_99_12 <- full_join(elk_99_11, elk12, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(elk_99_11)

elk_99_13 <- full_join(elk_99_12, elk13, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(elk_99_12)

elk_99_14 <- full_join(elk_99_13, elk14, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(elk_99_13)

elk_99_15 <- full_join(elk_99_14, elk15, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(elk_99_14)

elk_99_16 <- full_join(elk_99_15, elk16, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(elk_99_15)

elk_99_17 <- full_join(elk_99_16, elk17, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(elk_99_16)

elk_99_18 <- full_join(elk_99_17, elk18, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(elk_99_17)
remove(elk99)
remove(elk00)
remove(elk01)
remove(elk02)
remove(elk03)
remove(elk04)
remove(elk05)
remove(elk06)
remove(elk07)
remove(elk08)
remove(elk09)
remove(elk10)
remove(elk11)
remove(elk12)
remove(elk13)
remove(elk14)
remove(elk15)
remove(elk16)
remove(elk17)
remove(elk18)
```

```{r Elkhorn graph prep, warning=FALSE, echo=FALSE}
elk_99_18_species <- elk_99_18 %>%
  filter(intercepts > 0) %>%
  select("rep", "year", "species.name", "intercepts", "guild") %>%
  mutate(site = "Elkhorn")
elk_99_18_species$species.name <- as.character(elk_99_18_species$species.name)
elk_99_18_species$species.name <- as.factor(elk_99_18_species$species.name)
elk_99_18_species$year <- as.integer(elk_99_18_species$year)
elk_99_18_species$year <- as.numeric(elk_99_18_species$year)

elkhorn_data <- elk_99_18_species

# removing unwanted guilds (moss, litter, etc.)
elk_99_18_species <- elk_99_18_species %>%
  group_by(rep, year, guild, species.name) %>%
  summarize(intercepts = sum(intercepts)) %>%
  filter(guild != "Moss",
         guild != "Thatch",
         guild != "Bare")

unique(elk_99_18_species$species.name)
unique(elk_99_18_species$guild)

elk_99_18_guilds <- elk_99_18_species %>%
  group_by(rep, year, guild) %>%
  summarize(guildtotal = sum(intercepts)) %>%
  ungroup() %>%
  group_by(year, guild) %>%
  summarize(mean.intercepts = mean(guildtotal))

Elk_Richness  <- elk_99_18_species %>%
  group_by(year) %>%
  summarize(rich = n_distinct(species.name))

```

```{r Elkhorn overview, include=FALSE}
ggplot(Elk_Richness, aes (x = year,  y = rich)) +
  geom_line () +
  geom_point() +
  labs(title = "Species Richness over time \n Elkhorn Slough",
       y = "Species Richness",
       x = "Year") +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        axis.text.y = element_text(colour="black", size = 10),
        axis.title.y = element_text(colour="black", size = 12),
        axis.ticks.y = element_line(colour = "black"),
        axis.text.x = element_text(colour="black", size = 10, angle = -45),
        axis.title.x = element_text(colour="black", size = 12),
        axis.ticks.x = element_line(colour = "black"),
        legend.position ="bottom",
        plot.title = element_text(hjust = 0.5),
        strip.background = element_rect(fill = "white"),
        strip.text = element_text(color = "black", size = 12)) +
  coord_cartesian(ylim = c(0, 25)) +
  scale_y_continuous(breaks = seq(0, 25, 5), expand = c(0,0)) +
  scale_x_continuous(breaks= seq(1999, 2018, 1))

unique(elk_99_18_species$species.name)
```

```{r Removing extra elkhorn objects}
remove(elk_99_18_guilds)
remove(elk_99_18_species)
remove(elk_guilds)
remove(elkspp)
remove(elk_99_18)
remove(Elk_Richness)
```

## Jasper
These data were collected from Jasper Ridge from 1983 to 2015.  

```{r Jasper Data Import & Clean, include=FALSE}
Jasper_Veg <- read.csv("ComComp Data Cleanup/Jasper/JR_cover_forJosie.csv") %>%
  select(-X) %>%
  spread(key = species, value = cover) %>%
  replace(is.na(.), 0) %>%
  gather("aghe":"vumi", key = species, value = cover) %>%
  group_by(uniqueID, year, species) %>%
  summarize(cover = mean(cover))

JR_spp <- read.csv("ComComp Data Cleanup/Jasper/JR_speciesnames2.csv")

Jasper <- left_join(Jasper_Veg, JR_spp, by = "species")

Jasper_species <- Jasper %>%
  select("uniqueID", "year", "species.name", "cover", "guild") %>%
  mutate(site = "Jasper") %>%
  filter(cover > 0)

jasper_data <- Jasper_species
```

```{r Jasper spp check, echo=FALSE}
jasper_spp_check <- jasper_data  %>%
  group_by(species.name, guild) %>%
  summarise(mean = mean(cover))
```

```{r Removing extra jasper objects}
remove(Jasper)
remove(Jasper_species)
remove(Jasper_Veg)
remove(JR_spp)
remove(jasper_spp_check)
```

## McLaughlin Annual
Like the McLauglin Serpentine dataset, these data were collected at McLauglin Reserve in Northern California from 2000-2014 by Susan Harrison. These data represent 42 annual grassland plots, and were measured using 1m^2^ quadrats. Data is richness only from 2000-2005, but full community data 2006-2014. 

```{r McLaughlin Importing and Cleaning Data, include = FALSE}

## importing the data
McLAnn <- read.csv("ComComp Data Cleanup/McLaughlin/Core_Community_Data2019.csv")
McL_Sites <- read.csv("AbioticSiteData.csv") %>%
  rename(Site = site)
McL_spp <- read.csv("ComComp Data Cleanup/McLaughlin/McLaughlin_FunctionalGroups.csv")

## combining the data with site infomation, filtering to just serptentine sites
McLAnn <- left_join(McLAnn, McL_Sites, by = "Site")
McLAnn <- McLAnn %>%
  filter(Serpentine == "N") %>%
  rename(plot = Site)

## combining the guild information, creating a "guild" column, selecting only the desired info
McLAnn <- left_join(McLAnn, McL_spp, by = "Species_Name") %>%
  rename(nat.exo = Native.Exotic,
         lifeform = Grass.Forb.Shrub,
         ann.per = Annual.Perennial) %>%
  mutate(Guild1 = str_sub(nat.exo, 1, 1),
         Guild3 = str_sub(lifeform, 1, 1),
         Guild2 = str_sub(ann.per, 1, 1)) %>%
  unite(Guild1, Guild2, col = "Guild1", sep = "") %>%
  unite(Guild1, Guild3, col = "guild", sep = "") %>%
  mutate(Site = "McLAnn") %>%
  select(Year, Site, plot, Quadrat, Cover, Species_Name, nat.exo, ann.per, lifeform, guild)

mclann_data <- McLAnn

```

```{r MCL Ann spp check, echo=FALSE}
mclann_spp_check <- McLAnn  %>%
  group_by(Species_Name, guild) %>%
  summarise(mean = mean(Cover))
```


Generally, everything looks okay, though we have a few rows of data we'll want to omit later on.

```{r McL Annual Graph Prep & graphing, warning=FALSE, include=FALSE}
## Finding richness per year
McLAnn_rich  <- McLAnn %>%
  filter(Species_Name != "Bare" &
           Species_Name != "Rock") %>%
  group_by(Year, plot) %>%
  summarize(rich = n_distinct(Species_Name)) %>%
  group_by(Year) %>%
  summarise(meanrich = mean(rich))

ggplot(McLAnn_rich, aes (x = Year,  y = meanrich)) +
  geom_line () +
  geom_point() +
  labs(title = "Plot-level Species Richness over time \n McLaughlin Serpentine",
       y = "Species Richness",
       x = "Year") +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        axis.text.y = element_text(colour="black", size = 10),
        axis.title.y = element_text(colour="black", size = 12),
        axis.ticks.y = element_line(colour = "black"),
        axis.text.x = element_text(colour="black", size = 10, angle = -45),
        axis.title.x = element_text(colour="black", size = 12),
        axis.ticks.x = element_line(colour = "black"),
        legend.position ="bottom",
        plot.title = element_text(hjust = 0.5),
        strip.background = element_rect(fill = "white"),
        strip.text = element_text(color = "black", size = 12)) +
  coord_cartesian(ylim = c(0, 35)) +
  scale_y_continuous(breaks = seq(0, 35, 5), expand = c(0,0)) +
  scale_x_continuous(breaks= seq(2000, 2019, 1))

unique(McLAnn$Species_Name)
```

```{r Removing extra McLAnn objects}
remove(McL_Sites)
remove(McL_spp)
remove(mclann_spp_check)
remove(McLAnn)
```

## McLaughlin Serpentine
These data were collected by Susan Harrison from serpentine grassland sites at McLaughlin Reserve in Northern Californa. These data are for 38 plots that were measured using 1m^2^ quadrats. Data collected 2000-2014; richness only from 2000-2005 but full community data 2006-2014. 

```{r Import and Clean McL Serpentine, include = FALSE}
setwd("McLaughlin")

## importing the data
McLSerp <- read.csv("ComComp Data Cleanup/McLaughlin/Core_Community_Data2019.csv")
McL_Sites <- read.csv("ComComp Data Cleanup/McLaughlin/AbioticSiteData.csv") %>%
  rename(Site = site)
McL_spp <- read.csv("ComComp Data Cleanup/McLaughlin/McLaughlin_FunctionalGroups.csv") 

## combining the data with site infomation, filtering to just serptentine sites
McLSerp <- left_join(McLSerp, McL_Sites, by = "Site")
McLSerp <- McLSerp %>%
  filter(Serpentine == "S") %>%
  rename(plot = Site)

## combining the guild information, creating a "guild" column, selecting only the desired info
McLSerp <- left_join(McLSerp, McL_spp, by = "Species_Name") %>%
  rename(nat.exo = Native.Exotic,
         lifeform = Grass.Forb.Shrub,
         ann.per = Annual.Perennial) %>%
  mutate(Guild1 = str_sub(nat.exo, 1, 1),
         Guild3 = str_sub(lifeform, 1, 1),
         Guild2 = str_sub(ann.per, 1, 1)) %>%
  unite(Guild1, Guild2, col = "Guild1", sep = "") %>%
  unite(Guild1, Guild3, col = "guild", sep = "") %>%
  mutate(Site = "McLSerp") %>%
  select(Year, Site, plot, Quadrat, Cover, Species_Name, nat.exo, ann.per, lifeform, guild)

mclserp_data <- McLSerp
```

*Note to self that the McLaughlin data is richness only from 2000-2005, so I will likely not be able to do the same CTI analysis on that full dataset.*

```{r MCL Ann spp check, echo=FALSE}
mclserp_spp_check <- mclserp_data  %>%
  group_by(Species_Name, guild) %>%
  summarise(mean = mean(Cover))
```
As with the annual mcL dataset, there are a few species rows we'll eventually want to cut out.  
Also, there are a LOT of species in this dataset!

```{r McL Serpentine Graph Prep & graphing, warning=FALSE, include=FALSE}
## Finding richness per year
McLSerp_rich  <- McLSerp %>%
  filter(Species_Name != "Bare" &
           Species_Name != "Rock") %>%
  group_by(Year, plot) %>%
  summarize(rich = n_distinct(Species_Name)) %>%
  group_by(Year) %>%
  summarise(meanrich = mean(rich))

ggplot(McLSerp_rich, aes (x = Year,  y = meanrich)) +
  geom_line () +
  geom_point() +
  labs(title = "Plot-level Species Richness over time \n McLaughlin Serpentine",
       y = "Species Richness",
       x = "Year") +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        axis.text.y = element_text(colour="black", size = 10),
        axis.title.y = element_text(colour="black", size = 12),
        axis.ticks.y = element_line(colour = "black"),
        axis.text.x = element_text(colour="black", size = 10, angle = -45),
        axis.title.x = element_text(colour="black", size = 12),
        axis.ticks.x = element_line(colour = "black"),
        legend.position ="bottom",
        plot.title = element_text(hjust = 0.5),
        strip.background = element_rect(fill = "white"),
        strip.text = element_text(color = "black", size = 12)) +
  coord_cartesian(ylim = c(0, 35)) +
  scale_y_continuous(breaks = seq(0, 35, 5), expand = c(0,0)) +
  scale_x_continuous(breaks= seq(2000, 2014, 1))

unique(McLSerp$Species_Name)
unique(McLSerp$guild)
```

```{r Removing extra McLAnn objects}
remove(McL_Sites)
remove(McL_spp)
remove(mclserp_spp_check)
remove(McLSerp)
remove(McLSerp_rich)
```

## Santa Rosa
Incomplete at this time. 

## Swanton
These are data for grassland plots at Swanton Ranch. Data were collected by Karen Holl and Grey Hayes between 1999 and 2012. These data are structured similarly to the Elkhorn slough plots, so the code is also similar.For these analyses, I am using on the control plots (n=3), and removing all other treatments from the dataset. 

```{r Importing Swanton, warning=FALSE, echo=FALSE}


Swanspp <- read.csv("ComComp Data Cleanup/HollData/ElkhornSpecies.csv")
Swanspp$species.code <- tolower(Swanspp$species.code)
Swan_guilds <- read.csv("ComComp Data Cleanup/HollData/ElkhornGuilds.csv")

Swan99 <- read.csv("ComComp Data Cleanup/HollData/Elk_1999.csv",  skip = 4)
Swan00 <- read.csv("ComComp Data Cleanup/HollData/Elk_2000.csv", skip = 3)
Swan01 <- read.csv("ComComp Data Cleanup/HollData/Elk_2001.csv", skip = 3)
Swan02 <- read.csv("ComComp Data Cleanup/HollData/Elk_2002.csv", skip = 3)
Swan03 <- read.csv("ComComp Data Cleanup/HollData/Elk_2003.csv")
Swan04 <- read.csv("ComComp Data Cleanup/HollData/Elk_2004.csv")
Swan05 <- read.csv("ComComp Data Cleanup/HollData/Elk_2005.csv")
Swan06 <- read.csv("ComComp Data Cleanup/HollData/Elk_2006.csv")
Swan07 <- read.csv("ComComp Data Cleanup/HollData/Elk_2007.csv")
Swan08 <- read.csv("ComComp Data Cleanup/HollData/swanton_08.csv", skip = 1)
Swan09 <- read.csv("ComComp Data Cleanup/HollData/Elk_2009.csv")
Swan10 <- read.csv("ComComp Data Cleanup/HollData/Elk_2010.csv", skip = 1)
Swan11 <- read.csv("ComComp Data Cleanup/HollData/Elk_2011.csv")
Swan12 <- read.csv("ComComp Data Cleanup/HollData/Elk_2012.csv")

```

```{r Cleaning Swanton, warning=FALSE, echo=FALSE}
Swan99 <- Swan99 %>%
  filter(freq == "con",
         site == "swan") %>%
  mutate(year = "1999")
Swan99 <- gather(Swan99, "anaarv9":"bare9", key = "species.code", value = "intercepts")
Swan99$species.code <- substr(Swan99$species.code, 1, nchar(Swan99$species.code)-1) 
Swan99$species.code <- tolower(Swan99$species.code)
Swan99 <- left_join(Swan99, Swanspp, by = "species.code")
Swan99$intercepts <- as.numeric(Swan99$intercepts)

Swan00 <- Swan00 %>%
  filter(site == "swa",
         freq == "con") %>%
  select(site:naspul) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"naspul", key = "species.code", value = "intercepts") %>%
  mutate(year = "2000")
Swan00$species.code <- tolower(Swan00$species.code)
Swan00 <- left_join(Swan00, Swanspp, by = "species.code")
Swan00 <- spread(Swan00, key = plot, value = intercepts) %>%
  rename(plot1 = "1", 
         plot2 = "2",
         plot3 = "3",
         plot4 = "4") %>%
  mutate(intercepts = (plot1 + plot2 + plot3 + plot4)) %>%
  select(-plot1, -plot2, -plot3, -plot4)
Swan00$intercepts <- as.numeric(Swan00$intercepts)

Swan01 <- Swan01 %>%
  filter(site == "swan",
         freq == "con") %>%
  select(site:thatch) %>%
  replace(is.na(.), 0) %>%
  gather("anaarv":"thatch", key = "species.code", value = "intercepts") %>%
  mutate(year = "2001")
Swan01$species.code <- tolower(Swan01$species.code)
Swan01 <- left_join(Swan01, Swanspp, by = "species.code")
Swan01 <- spread(Swan01, key = plot, value = intercepts) %>%
  rename(plot1 = "1", 
         plot2 = "2",
         plot3 = "3",
         plot4 = "4") %>%
  mutate(intercepts = (plot1 + plot2 + plot3 + plot4)) %>%
  select(-plot1, -plot2, -plot3, -plot4)
Swan01$intercepts <- as.numeric(Swan01$intercepts)

Swan02 <- Swan02 %>%
  filter(Site == "swa",
         Frequency == "con") %>%
  select(Site:thatch) %>%
  replace(is.na(.), 0) %>%
  gather("anaarv":"thatch", key = "species.code", value = "intercepts") %>%
  mutate(year = "2002")
names(Swan02) <- tolower(names(Swan02))
Swan02 <- Swan02 %>%
  rename(site = site,
         freq = frequency,
         treat = treatment,
         rep = replicate) 
Swan02$intercepts <- as.numeric(Swan02$intercepts)
Swan02 <- left_join(Swan02, Swanspp, by = "species.code")

Swan03 <- Swan03 %>%
  filter(SITE == "swa",
         FREQ == "con") %>%
  select(SITE:vulpsp) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"vulpsp", key = "species.code", value = "intercepts") %>%
  mutate(year = "2003")
names(Swan03) <- tolower(names(Swan03))
Swan03 <- left_join(Swan03, Swanspp, by = "species.code")

Swan04 <- Swan04 %>%
  filter(SITE == "swa",
         FREQ == "con") %>%
  select(SITE:vulpsp) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"vulpsp", key = "species.code", value = "intercepts") %>%
  mutate(year = "2004") 
names(Swan04) <- tolower(names(Swan04))
Swan04 <- left_join(Swan04, Swanspp, by = "species.code")

Swan05 <- Swan05 %>%
  filter(SITE == "swa",
         FREQ == "con") %>%
  select(SITE:vulpsp) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"vulpsp", key = "species.code", value = "intercepts") %>%
  mutate(year = "2005")
names(Swan05) <- tolower(names(Swan05))
Swan05 <- left_join(Swan05, Swanspp, by = "species.code")

Swan06 <- Swan06 %>%
  filter(SITE == "swa",
         FREQ == "con") %>%
  select(SITE:vulpsp) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"vulpsp", key = "species.code", value = "intercepts") %>%
  mutate(year = "2006")
names(Swan06) <- tolower(names(Swan06))
Swan06 <- left_join(Swan06, Swanspp, by = "species.code")

Swan07 <- Swan07 %>%
  filter(SITE == "swa",
         FREQ == "con") %>%
  select(SITE:vulpsp) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"vulpsp", key = "species.code", value = "intercepts") %>%
  mutate(year = "2007")
names(Swan07) <- tolower(names(Swan07))
Swan07 <- left_join(Swan07, Swanspp, by = "species.code")

Swan08 <- Swan08 %>%
  filter(SITE == "SWANTON",
         FREQ == "CON") %>%
  select(SITE:spearv) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"spearv", key = "species.code", value = "intercepts") %>%
  mutate(year = "2008")
names(Swan08) <- tolower(names(Swan08)) 
Swan08 <- left_join(Swan08, Swanspp, by = "species.code")

Swan09 <- Swan09 %>%
  filter(SITE == "swa",
         FREQ == "CONTROL") %>%
  select(SITE:vulpsp, -Comments) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"vulpsp", key = "species.code", value = "intercepts") %>%
  mutate(year = "2009")
names(Swan09) <- tolower(names(Swan09))
Swan09 <- left_join(Swan09, Swanspp, by = "species.code")

Swan10 <- Swan10 %>%
  filter(SITE == "swa",
         FREQ == "CONTROL") %>%
  select(SITE:vulpsp, -Comments) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"vulpsp", key = "species.code", value = "intercepts") %>%
  mutate(year = "2010")
names(Swan10) <- tolower(names(Swan10))
Swan10$intercepts <- as.numeric(Swan10$intercepts)
Swan10 <- left_join(Swan10, Swanspp, by = "species.code")

Swan11 <- Swan11 %>%
  filter(SITE == "swa",
         FREQ == "CONTROL") %>%
  select(SITE:vulpsp, -Comments) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"vulpsp", key = "species.code", value = "intercepts") %>%
  mutate(year = "2011")
names(Swan11) <- tolower(names(Swan11))
Swan11$intercepts <- as.numeric(Swan11$intercepts)
Swan11 <- left_join(Swan11, Swanspp, by = "species.code")

Swan12 <- Swan12 %>%
  filter(SITE == "swa",
         FREQ == "CONTROL") %>%
  select(SITE:vulpsp, -Comments) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"vulpsp", key = "species.code", value = "intercepts") %>%
  mutate(year = "2012")
names(Swan12) <- tolower(names(Swan12))
Swan12$intercepts <- as.numeric(Swan12$intercepts)
Swan12 <- left_join(Swan12, Swanspp, by = "species.code")
```

Once the data is cleaned up on a yearly basis, we can combine the years into a single dataframe. 

```{r Compiling Swanton, warning=FALSE, echo=FALSE}
Swan_99_00 <- full_join(Swan99, Swan00, by = c("site", "freq", "treat", "rep", "year",
                                          "species.code", "species.name", "guild",
                                          "nat.exo", "ann.perr", "lifeform",
                                          "intercepts"))

Swan_99_01 <- full_join(Swan_99_00, Swan01, by = c("site", "freq", "treat", "rep", "year",
                                          "species.code", "species.name", "guild",
                                          "nat.exo", "ann.perr", "lifeform",
                                          "intercepts"))
remove(Swan_99_00)

Swan_99_02 <- full_join(Swan_99_01, Swan02, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(Swan_99_01)

Swan_99_03 <- full_join(Swan_99_02, Swan03, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(Swan_99_02)

Swan_99_04 <- full_join(Swan_99_03, Swan04, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(Swan_99_03)

Swan_99_05 <- full_join(Swan_99_04, Swan05, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(Swan_99_04)

Swan_99_06 <- full_join(Swan_99_05, Swan06, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(Swan_99_05)

Swan_99_07 <- full_join(Swan_99_06, Swan07, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(Swan_99_06)

Swan_99_08 <- full_join(Swan_99_07, Swan08, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(Swan_99_07)

Swan_99_09 <- full_join(Swan_99_08, Swan09, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(Swan_99_08)

Swan_99_10 <- full_join(Swan_99_09, Swan10, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(Swan_99_09)

Swan_99_11 <- full_join(Swan_99_10, Swan11, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(Swan_99_10)

Swan_99_12 <- full_join(Swan_99_11, Swan12, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(Swan_99_11)

remove(Swan99)
remove(Swan00)
remove(Swan01)
remove(Swan02)
remove(Swan03)
remove(Swan04)
remove(Swan05)
remove(Swan06)
remove(Swan07)
remove(Swan08)
remove(Swan09)
remove(Swan10)
remove(Swan11)
remove(Swan12)
```

```{r Swanton Graph Prep, warning=FALSE, echo=FALSE}
Swan_99_12_species <- Swan_99_12 %>%
  filter(intercepts > 0) %>%
  select("rep", "year", "species.name", "intercepts", "guild") %>%
  mutate(site = "Swan")
Swan_99_12_species$species.name <- as.character(Swan_99_12_species$species.name)
Swan_99_12_species$species.name <- as.factor(Swan_99_12_species$species.name)
Swan_99_12_species$year <- as.integer(Swan_99_12_species$year)
Swan_99_12_species$year <- as.numeric(Swan_99_12_species$year)

swanton_data <- Swan_99_12_species

Swan_99_12_species <- Swan_99_12_species %>%
  group_by(rep, year, guild, species.name) %>%
  summarize(intercepts = sum(intercepts))
  
Swan_99_12_guilds <- Swan_99_12_species %>%
  group_by(rep, year, guild, species.name) %>%
  summarize(intercepts = sum(intercepts)) %>%
  group_by(rep, year, guild) %>%
  summarize(guildtotal = sum(intercepts)) %>%
  ungroup() %>%
  group_by(year, guild) %>%
  summarize(mean.intercepts = mean(guildtotal))

Swan_Richness  <- Swan_99_12_species %>%
  filter(guild != "Moss" &
           guild != "Thatch" &
           guild != "Bare ground") %>%
  group_by(year) %>%
  summarize(rich = n_distinct(species.name))

```

```{r Swanton Overview, include=FALSE}
ggplot(Swan_Richness, aes (x = year,  y = rich)) +
  geom_line () +
  geom_point() +
  labs(title = "Species Richness over time \n Swanton Ranch",
       y = "Species Richness",
       x = "Year") +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        axis.text.y = element_text(colour="black", size = 10),
        axis.title.y = element_text(colour="black", size = 12),
        axis.ticks.y = element_line(colour = "black"),
        axis.text.x = element_text(colour="black", size = 10, angle = -45),
        axis.title.x = element_text(colour="black", size = 12),
        axis.ticks.x = element_line(colour = "black"),
        legend.position ="bottom",
        plot.title = element_text(hjust = 0.5),
        strip.background = element_rect(fill = "white"),
        strip.text = element_text(color = "black", size = 12)) +
  coord_cartesian(ylim = c(0, 25)) +
  scale_y_continuous(breaks = seq(0, 25, 5), expand = c(0,0)) +
  scale_x_continuous(breaks= seq(1999, 2012, 1))

unique(Swan_99_12_species$species.name)
```

__Something I may want to consider is combining all of the *Bromus* species into one group.__

```{r Removing extra Swanton objects}
remove(Swan_99_12)
remove(Swan_99_12_species)
remove(Swan_99_12_guilds)
remove(Swan_Richness)
remove(Swanspp)
remove(Swan_guilds)
```

## UCSC
These are data for grassland plots at UCSC. Data were collected by Karen Holl and Grey Hayes between 1999 and 2012. These data are structured similarly to the Elkhorn slough plots, so the code is also similar. For these analyses, I am using on the control plots (n=3), and removing all other treatments from the dataset. 

```{r Importing UCSC, warning=FALSE, echo=FALSE}

UCSCspp <- read.csv("ComComp Data Cleanup/HollData/ElkhornSpecies.csv")
UCSCspp$species.code <- tolower(UCSCspp$species.code)
UCSC_guilds <- read.csv("ComComp Data Cleanup/HollData/ElkhornGuilds.csv")

UCSC99 <- read.csv("ComComp Data Cleanup/HollData/Elk_1999.csv",  skip = 4)
UCSC00 <- read.csv("ComComp Data Cleanup/HollData/Elk_2000.csv", skip = 3)
UCSC01 <- read.csv("ComComp Data Cleanup/HollData/Elk_2001.csv", skip = 3)
UCSC02 <- read.csv("ComComp Data Cleanup/HollData/Elk_2002.csv", skip = 3)
UCSC03 <- read.csv("ComComp Data Cleanup/HollData/Elk_2003.csv")
UCSC04 <- read.csv("ComComp Data Cleanup/HollData/Elk_2004.csv")
UCSC05 <- read.csv("ComComp Data Cleanup/HollData/Elk_2005.csv")
UCSC06 <- read.csv("ComComp Data Cleanup/HollData/Elk_2006.csv")
UCSC07 <- read.csv("ComComp Data Cleanup/HollData/Elk_2007.csv")
UCSC08 <- read.csv("ComComp Data Cleanup/HollData/ucsc_08.csv")
UCSC09 <- read.csv("ComComp Data Cleanup/HollData/Elk_2009.csv")
UCSC10 <- read.csv("ComComp Data Cleanup/HollData/Elk_2010.csv", skip = 1)
UCSC11 <- read.csv("ComComp Data Cleanup/HollData/Elk_2011.csv")
UCSC12 <- read.csv("ComComp Data Cleanup/HollData/Elk_2012.csv")
```

After creating objects for each year, we will clean each to a compatible structure. 

```{r Cleaning UCSC, warning=FALSE, echo=FALSE}
UCSC99 <- UCSC99 %>%
  filter(freq == "con",
         site == "ucsc") %>%
  mutate(year = "1999")
UCSC99 <- gather(UCSC99, "anaarv9":"bare9", key = "species.code", value = "intercepts")
UCSC99$species.code <- substr(UCSC99$species.code, 1, nchar(UCSC99$species.code)-1) 
UCSC99$species.code <- tolower(UCSC99$species.code)
UCSC99 <- left_join(UCSC99, UCSCspp, by = "species.code")
UCSC99$intercepts <- as.numeric(UCSC99$intercepts)

UCSC00 <- UCSC00 %>%
  filter(site == "ucsc",
         freq == "con") %>%
  select(site:naspul) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"naspul", key = "species.code", value = "intercepts") %>%
  mutate(year = "2000")
UCSC00$species.code <- tolower(UCSC00$species.code)
UCSC00 <- left_join(UCSC00, UCSCspp, by = "species.code")
UCSC00 <- spread(UCSC00, key = plot, value = intercepts) %>%
  rename(plot1 = "1", 
         plot2 = "2",
         plot3 = "3",
         plot4 = "4") %>%
  mutate(intercepts = (plot1 + plot2 + plot3 + plot4)) %>%
  select(-plot1, -plot2, -plot3, -plot4)
UCSC00$intercepts <- as.numeric(UCSC00$intercepts)

UCSC01 <- UCSC01 %>%
  filter(site == "ucsc",
         freq == "con") %>%
  select(site:thatch) %>%
  replace(is.na(.), 0) %>%
  gather("anaarv":"thatch", key = "species.code", value = "intercepts") %>%
  mutate(year = "2001")
UCSC01$species.code <- tolower(UCSC01$species.code)
UCSC01 <- left_join(UCSC01, UCSCspp, by = "species.code")
UCSC01 <- spread(UCSC01, key = plot, value = intercepts) %>%
  rename(plot1 = "1", 
         plot2 = "2",
         plot3 = "3",
         plot4 = "4") %>%
  mutate(intercepts = (plot1 + plot2 + plot3 + plot4)) %>%
  select(-plot1, -plot2, -plot3, -plot4)
UCSC01$intercepts <- as.numeric(UCSC01$intercepts)

UCSC02 <- UCSC02 %>%
  filter(Site == "elk",
         Frequency == "con") %>%
  select(Site:thatch) %>%
  replace(is.na(.), 0) %>%
  gather("anaarv":"thatch", key = "species.code", value = "intercepts") %>%
  mutate(year = "2002")
names(UCSC02) <- tolower(names(UCSC02))
UCSC02 <- UCSC02 %>%
  rename(site = site,
         freq = frequency,
         treat = treatment,
         rep = replicate) 
UCSC02$intercepts <- as.numeric(UCSC02$intercepts)
UCSC02 <- left_join(UCSC02, UCSCspp, by = "species.code")

UCSC03 <- UCSC03 %>%
  filter(SITE == "ucsc",
         FREQ == "con") %>%
  select(SITE:vulpsp) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"vulpsp", key = "species.code", value = "intercepts") %>%
  mutate(year = "2003")
names(UCSC03) <- tolower(names(UCSC03))
UCSC03 <- left_join(UCSC03, UCSCspp, by = "species.code")

UCSC04 <- UCSC04 %>%
  filter(SITE == "ucsc",
         FREQ == "con") %>%
  select(SITE:vulpsp) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"vulpsp", key = "species.code", value = "intercepts") %>%
  mutate(year = "2004") 
names(UCSC04) <- tolower(names(UCSC04))
UCSC04 <- left_join(UCSC04, UCSCspp, by = "species.code")

UCSC05 <- UCSC05 %>%
  filter(SITE == "ucsc",
         FREQ == "con") %>%
  select(SITE:vulpsp) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"vulpsp", key = "species.code", value = "intercepts") %>%
  mutate(year = "2005")
names(UCSC05) <- tolower(names(UCSC05))
UCSC05 <- left_join(UCSC05, UCSCspp, by = "species.code")

UCSC06 <- UCSC06 %>%
  filter(SITE == "ucsc",
         FREQ == "con") %>%
  select(SITE:vulpsp) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"vulpsp", key = "species.code", value = "intercepts") %>%
  mutate(year = "2006")
names(UCSC06) <- tolower(names(UCSC06))
UCSC06 <- left_join(UCSC06, UCSCspp, by = "species.code")

UCSC07 <- UCSC07 %>%
  filter(SITE == "ucsc",
         FREQ == "con") %>%
  select(SITE:vulpsp) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"vulpsp", key = "species.code", value = "intercepts") %>%
  mutate(year = "2007")
names(UCSC07) <- tolower(names(UCSC07))
UCSC07 <- left_join(UCSC07, UCSCspp, by = "species.code")

UCSC08 <- UCSC08 %>%
  filter(SITE == "UCSC",
         FREQ == "CON") %>%
  select(SITE:brohor) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"brohor", key = "species.code", value = "intercepts") %>%
  mutate(year = "2008")
names(UCSC08) <- tolower(names(UCSC08))
UCSC08 <- left_join(UCSC08, UCSCspp, by = "species.code")

UCSC09 <- UCSC09 %>%
  filter(SITE == "elk",
         FREQ == "CONTROL") %>%
  select(SITE:vulpsp, -Comments) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"vulpsp", key = "species.code", value = "intercepts") %>%
  mutate(year = "2009")
names(UCSC09) <- tolower(names(UCSC09))
UCSC09 <- left_join(UCSC09, UCSCspp, by = "species.code")

UCSC10 <- UCSC10 %>%
  filter(SITE == "ucsc",
         FREQ == "CONTROL") %>%
  select(SITE:vulpsp, -Comments) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"vulpsp", key = "species.code", value = "intercepts") %>%
  mutate(year = "2010")
names(UCSC10) <- tolower(names(UCSC10))
UCSC10$intercepts <- as.numeric(UCSC10$intercepts)
UCSC10 <- left_join(UCSC10, UCSCspp, by = "species.code")

UCSC11 <- UCSC11 %>%
  filter(SITE == "ucsc",
         FREQ == "CONTROL") %>%
  select(SITE:vulpsp, -Comments) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"vulpsp", key = "species.code", value = "intercepts") %>%
  mutate(year = "2011")
names(UCSC11) <- tolower(names(UCSC11))
UCSC11$intercepts <- as.numeric(UCSC11$intercepts)
UCSC11 <- left_join(UCSC11, UCSCspp, by = "species.code")

UCSC12 <- UCSC12 %>%
  filter(SITE == "ucsc",
         FREQ == "CONTROL") %>%
  select(SITE:vulpsp, -Comments) %>%
  replace(is.na(.), 0) %>%
  gather("aircar":"vulpsp", key = "species.code", value = "intercepts") %>%
  mutate(year = "2012")
names(UCSC12) <- tolower(names(UCSC12))
UCSC12$intercepts <- as.numeric(UCSC12$intercepts)
UCSC12 <- left_join(UCSC12, UCSCspp, by = "species.code")
```

Once the data is cleaned and in a similar format, it's ready to be compiled. 

```{r Compiling UCSC, warning=FALSE, echo=FALSE}
UCSC_99_00 <- full_join(UCSC99, UCSC00, by = c("site", "freq", "treat", "rep", "year",
                                          "species.code", "species.name", "guild",
                                          "nat.exo", "ann.perr", "lifeform",
                                          "intercepts"))

UCSC_99_01 <- full_join(UCSC_99_00, UCSC01, by = c("site", "freq", "treat", "rep", "year",
                                          "species.code", "species.name", "guild",
                                          "nat.exo", "ann.perr", "lifeform",
                                          "intercepts"))
remove(UCSC_99_00)

UCSC_99_02 <- full_join(UCSC_99_01, UCSC02, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(UCSC_99_01)

UCSC_99_03 <- full_join(UCSC_99_02, UCSC03, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(UCSC_99_02)

UCSC_99_04 <- full_join(UCSC_99_03, UCSC04, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(UCSC_99_03)

UCSC_99_05 <- full_join(UCSC_99_04, UCSC05, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(UCSC_99_04)

UCSC_99_06 <- full_join(UCSC_99_05, UCSC06, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(UCSC_99_05)

UCSC_99_07 <- full_join(UCSC_99_06, UCSC07, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(UCSC_99_06)

UCSC_99_08 <- full_join(UCSC_99_07, UCSC08, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(UCSC_99_07)

UCSC_99_09 <- full_join(UCSC_99_08, UCSC09, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(UCSC_99_08)

UCSC_99_10 <- full_join(UCSC_99_09, UCSC10, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(UCSC_99_09)

UCSC_99_11 <- full_join(UCSC_99_10, UCSC11, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(UCSC_99_10)

UCSC_99_12 <- full_join(UCSC_99_11, UCSC12, by = c("site", "freq", "treat", "rep", "year",
                                                "species.code", "species.name", "guild",
                                                "nat.exo", "ann.perr", "lifeform",
                                                "intercepts"))
remove(UCSC_99_11)

remove(UCSC99)
remove(UCSC00)
remove(UCSC01)
remove(UCSC02)
remove(UCSC03)
remove(UCSC04)
remove(UCSC05)
remove(UCSC06)
remove(UCSC07)
remove(UCSC08)
remove(UCSC09)
remove(UCSC10)
remove(UCSC11)
remove(UCSC12)
```

```{r UCSC Graph Prep, warning=FALSE, echo=FALSE}
UCSC_99_12_species <- UCSC_99_12 %>%
  filter(intercepts > 0) %>%
  select("rep", "year", "species.name", "intercepts", "guild") %>%
  mutate(site = "UCSC")
UCSC_99_12_species$species.name <- as.character(UCSC_99_12_species$species.name)
UCSC_99_12_species$species.name <- as.factor(UCSC_99_12_species$species.name)
UCSC_99_12_species$year <- as.integer(UCSC_99_12_species$year)
UCSC_99_12_species$year <- as.numeric(UCSC_99_12_species$year)

UCSC_99_12_species <- UCSC_99_12_species %>%
  group_by(rep, year, guild, species.name) %>%
  summarize(intercepts = sum(intercepts)) 

ucsc_data <- UCSC_99_12_species

UCSC_99_12_guilds <- UCSC_99_12_species %>%
  group_by(rep, year, guild) %>%
  summarize(guildtotal = sum(intercepts)) %>%
  ungroup() %>%
  group_by(year, guild) %>%
  summarize(mean.intercepts = mean(guildtotal))

ucsc_data <- UCSC_99_12_species

UCSC_Richness  <- UCSC_99_12_species %>%
  filter(guild != "Moss" &
           guild != "Thatch" &
           guild != "Bare ground") %>%
  group_by(year) %>%
  summarize(rich = n_distinct(species.name))
```


```{r UCSC Overview, include=FALSE}
ggplot(UCSC_Richness, aes (x = year,  y = rich)) +
  geom_line () +
  geom_point() +
  labs(title = "Species Richness over time \n UCSC",
       y = "Species Richness",
       x = "Year") +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        axis.text.y = element_text(colour="black", size = 10),
        axis.title.y = element_text(colour="black", size = 12),
        axis.ticks.y = element_line(colour = "black"),
        axis.text.x = element_text(colour="black", size = 10, angle = -45),
        axis.title.x = element_text(colour="black", size = 12),
        axis.ticks.x = element_line(colour = "black"),
        legend.position ="bottom",
        plot.title = element_text(hjust = 0.5),
        strip.background = element_rect(fill = "white"),
        strip.text = element_text(color = "black", size = 12)) +
  coord_cartesian(ylim = c(0, 25)) +
  scale_y_continuous(breaks = seq(0, 25, 5), expand = c(0,0)) +
  scale_x_continuous(breaks= seq(1999, 2012, 1))

unique(UCSC_99_12_species$species.name)

```

__Something I may want to consider is combining all of the *Bromus* species into one group.__  

```{r Removing extra Swanton objects}
remove(UCSC_99_12)
remove(UCSC_99_12_species)
remove(UCSC_99_12_guilds)
remove(UCSC_Richness)
remove(UCSCspp)
remove(UCSC_guilds)
```
## Vasco Caves
Incomplete at this time.



# Saving data as .csvs

# ```{r Saving .csv files}
# write.csv(angelo_data, "angelo_data.csv")
# write.csv(carrizo_data, "carrizo_data.csv")
# write.csv(jasper_data, "jasper_data.csv")
# write.csv(elkhorn_data, "elkhorn_data.csv")
# write.csv(mclann_data, "mclann_data.csv")
# write.csv(mclserp_data, "mclserp_data.csv")
# write.csv(swanton_data, "swanton_data.csv")
# write.csv(ucsc_data, "ucsc_data.csv")
# ```

