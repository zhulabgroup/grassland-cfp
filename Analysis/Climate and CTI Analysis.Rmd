---
title: "Climate and CTI Analysis"
author: "Josie Lesage"
date: "1/17/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r data import}
climate_site <- read.csv("PRISM_data.csv")
climate_site_wtryr <- read.csv("PRISM_wtryr_data.csv")
```


```{r plots}
ggplot(climate_site, aes(x = site, y = tmean)) +
  geom_boxplot()  +
  geom_jitter(aes(color = month)) +
  labs(x = "site",
       y = "mean monthly temp, 1982-2019")

ggplot(climate_site, aes(x = site, y = ppt)) +
  geom_boxplot()  +
  geom_jitter(aes(color = month))+
  labs(x = "site",
       y = "mean monthly precip, 1982-2019")

ggplot(climate_site) +
  geom_jitter(aes(x = site, y = tmax), color = "red") +
  geom_jitter(aes(x = site, y = tmin), color = "blue") +
  labs(x = "site",
       y = "monthly mean and min temps, 1982-2019")
```

We're also interested in seeing how climate may or may not have changed over time - so we will generate annual summaries.

```{r annual climate change}
climate_site_wtryr_win <- climate_site %>% 
  filter(month == 12 | month == 01 | month == 02) %>%
  mutate(date1 = date,
         wateryr = wtr_yr(date1)) %>%
  group_by(site, wateryr) %>%
  summarise(precip = sum(ppt),
            tmean = mean(tmean),
            tmin = mean(tmin),
            tmax = mean(tmax)) %>%
  rename(year = wateryr) %>%
  filter(year != 2020)

climate_site_wtryr_sum <- climate_site %>% 
  filter(month == 06) %>%
  mutate(date1 = date,
         wateryr = wtr_yr(date1)) %>%
  group_by(site, wateryr) %>%
  summarise(precip = sum(ppt),
            tmean = mean(tmean),
            tmin = mean(tmin),
            tmax = mean(tmax)) %>%
  rename(year = wateryr) 

ggplot(climate_site_wtryr_win) +
  geom_point(aes(x = year, y = tmin, color = site), shape = 3) +
  geom_line(aes(x = year, y = tmin, color = site)) +
  labs(title = "Winter")


ggplot(climate_site_wtryr) +
  geom_point(aes(x = year, y = tmin, color = site), shape = 3) +
  geom_line(aes(x = year, y = tmin, color = site)) +
  labs(title = "Year")


ggplot(climate_site_wtryr) +
  geom_point(aes(x = year, y = precip, color = site), shape = 1) +
  geom_line(aes(x = year, y = precip, color = site))

ggplot(climate_site_wtryr_win) +
  geom_point(aes(x = year, y = tmean, color = site), shape = 1) +
    stat_smooth(aes(x = year, y = tmean, color = site), method = "lm", se = F, size =  1) +
  geom_point(aes(x = year, y = tmax, color = site), shape = 2) +
    stat_smooth(aes(x = year, y = tmax, color = site), method = "lm", se = F, size =  1) +
  geom_point(aes(x = year, y = tmin, color = site), shape = 3) +
    stat_smooth(aes(x = year, y = tmin, color = site), method = "lm", se = F, size =  1)

ggplot(climate_site_wtryr) +
  geom_point(aes(x = year, y = tmean, color = site), shape = 1) +
  geom_line(aes(x = year, y = tmean, color = site)) +
  geom_point(aes(x = year, y = tmax, color = site), shape = 2) +
  geom_line(aes(x = year, y = tmax, color = site)) +
  geom_point(aes(x = year, y = tmin, color = site), shape = 3) +
  geom_line(aes(x = year, y = tmin, color = site))

```


# CTI DATA
```{r CTI import}
McLAnn_CTI_rep <- McLAnn_CTI %>%
  rename(rep = plot,
         year = Year) %>%
  mutate(site = "McL Ann")

mcLserp_CTI_rep <- mcLserp_CTI %>%
  rename(rep = plot,
         year = Year) %>%
  mutate(site = "McL Serp")

elk_CTI_rep <- elk_CTI %>%
  mutate(site = "Elkhorn")

jasp_CTI_rep <- jasp_CTI %>%
  rename(rep = trtrep) %>%
  mutate(site = "Jasper")

ucsc_CTI_rep <- ucsc_CTI %>%
  mutate(site = "UCSC")

swan_CTI_rep <- swan_CTI %>%
  mutate(site = "Swanton")

car_CTI_rep <- car_CTI %>%
  rename(plot = Plot) %>%
  mutate(site = "Carrizo")

ang_CTI_rep <- ang_CTI %>%
  mutate(site = "Angelo")


sub.cti <- full_join(mcLserp_CTI_rep, McLAnn_CTI_rep)
sub.cti <- full_join(sub.cti, elk_CTI_rep)
sub.cti <- full_join(sub.cti, jasp_CTI_rep)
sub.cti <- full_join(sub.cti, ucsc_CTI_rep)
sub.cti <- full_join(sub.cti, swan_CTI_rep)
sub.cti <- full_join(sub.cti, car_CTI_rep)
sub.cti <- full_join(sub.cti, ang_CTI_rep)

```

# COMBINE DATA
The goal now is to combine the CTI and PRISM data into a single dataset that I can use to make graphs/analysis.

```{r combine datasets}
prism.cti <- left_join(sub.cti, climate_site_wtryr, by = c("year", "site"))

```

```{r explore combo}

prism.cti.cor <- prism.cti %>%
  select(year, precip, tmean, CPI, CTI)
pairs.panels(prism.cti.cor, scale=TRUE)
pairs(prism.cti.cor)

ggplot(prism.cti) +
  geom_point(aes(x = precip, y = CTI, color = site)) +
  stat_smooth(method = "lm", se = F, size = 1, aes(x = precip, y = CTI, color = site)) +
  labs(title = "Precipitation and CTI", x = "Precipitation (mm)", y = "CTI")

ggplot(prism.cti) +
  geom_point(aes(x = precip, y = CPI, color = site)) +
  stat_smooth(method = "lm", se = F, size = 1, aes(x = precip, y = CPI, color = site)) +
  labs(title = "Precipitation and CPI", x = "Precipitation (mm)", y = "CPI")

ggplot(prism.cti) +
  geom_point(aes(x = tmin, y = CTI, color = site)) +
  stat_smooth(method = "lm", se = F, size = 1, aes(x = tmin, y = CTI)) +
  geom_point(aes(x = tmean, y = CTI, color = site)) +
  stat_smooth(method = "lm", se = F, size = 1, aes(x = tmean, y = CTI)) +
  geom_point(aes(x = tmax, y = CTI, color = site)) +
  stat_smooth(method = "lm", se = F, size = 1, aes(x = tmax, y = CTI)) +
  labs(title = "Temperature and CTI", x = "Temperature (C)", y = "CTI")

ggplot(prism.cti) +
  geom_point(aes(x = tmin, y = CPI, color = site)) +
  stat_smooth(method = "lm", se = F, size = 1, aes(x = tmin, y = CPI)) +
  geom_point(aes(x = tmax, y = CPI, color = site)) +
  stat_smooth(method = "lm", se = F, size = 1, aes(x = tmax, y = CPI)) +
  labs(title = "Temperature and CPI", x = "Temperature (C)", y = "CPI")

ggplot(prism.cti) +
  geom_point(aes(x = tmin, y = CTI, color = site)) +
  stat_smooth(method = "lm", se = F, size = 1, aes(x = tmin, y = CTI, color = site)) +
  labs(title = "Temperature and CTI", x = "Temperature (C)", y = "CTI")

```

```{r means of CTI and temp}

prism.cti.means <- prism.cti %>%
  group_by(site) %>%
  summarise(mCTI = mean(CTI),
            seCTI = std.error(CTI),
            mCPI = mean(CPI),
            seCPI = std.error(CPI),
            mtmin = mean(tmin),
            setmin = std.error(tmin),
            mtmax = mean(tmax),
            setmax = std.error(tmax),
            mtmean = mean(tmean),
            setmean = std.error(tmean))

ggplot(prism.cti.means) +
  geom_point(aes(x = mtmin, y = mCTI, color = site)) +
  stat_smooth(method = "lm", se = F, size = 1, aes(x = mtmin, y = mCTI)) +
  stat_smooth(method = "lm", se = F, size = 1, aes(x = mtmin, y = mCTI, color = site)) +
  geom_point(aes(x = mtmean, y = mCTI, color = site)) +
  stat_smooth(method = "lm", se = F, size = 1, aes(x = mtmean, y = mCTI)) +
  geom_point(aes(x = mtmax, y = mCTI, color = site)) +
  stat_smooth(method = "lm", se = F, size = 1, aes(x = mtmax, y = mCTI)) +
  labs(title = "Temperature and CTI", x = "Temperature (C)", y = "CTI")

```



```{r summarize to annual data}
sum.prism.cti <- prism.cti %>%
  group_by(year, site) %>%
  summarise(CTI = mean(CTI),
            seCTI = std.error(CTI),
            CPI = mean(CPI),
            seCPI = std.error(CPI),
            tmean = mean(tmean),
            tmax = mean(tmax),
            tmin = mean(tmin),
            precip = mean(precip))

ggplot(sum.prism.cti) +
  geom_line(aes(x = year, y = CPI, color = site)) +
  geom_line(aes(x = year, y = precip), color = "blue")

ggplot(sum.prism.cti) +
  geom_line(aes(x = year, y = CTI, color = site)) +
  geom_line(aes(x = year, y = tmax), color = "red") +
  geom_line(aes(x = year, y = tmin), color = "orange") +
  geom_line(aes(x = year, y = tmean), color = "blue") 

```

# ANALYSIS