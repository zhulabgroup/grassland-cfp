---
title: "Climate and CTI Analysis"
author: "Josie Lesage"
date: "1/17/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = '../') 

## analysis
library(codyn)
library(MASS)
library(lme4)
library(nlme)


## misc/both/other
library(oz)
library(plotrix)
library(tidyverse)
library(gridExtra)

# to rip legends out of figures
g_legend <- function(a.gplot){ 
    tmp <- ggplot_gtable(ggplot_build(a.gplot)) 
    leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box") 
    legend <- tmp$grobs[[leg]] 
    legend
} 

# converts the year into the water year based on month
wtr_yr <- function(dates, start_month=10) {
  # Convert dates into POSIXlt
  dates.posix = as.POSIXlt(dates)
  # Year offset
  offset = ifelse(dates.posix$mon >= start_month - 1, 1, 0)
  # Water year
  adj.year = dates.posix$year + 1900 + offset
  # Return the water year
  adj.year
}

```

```{r data import, echo = FALSE, message = FALSE, warning = FALSE}
climate_site <- read.csv("Analysis/ClimData/PRISM_data.csv")
climate_site_wtryr <- read.csv("Analysis/ClimData/PRISM_wtryr_data.csv")

all.CTI <- read.csv("Analysis/CTI Data/AllSites_CTI.csv") %>%
  select(-X, -X.1) %>%
  mutate(site = factor(site, levels=c("Angelo", "Carrizo", "Elkhorn", "Jasper", "McL Ann", "McL Serp", "Swanton", "UCSC"))) %>%
  group_by(site, year) %>%
  summarise(meanCTI = mean(meanT),
            seCTI = std.error(meanT),
            meanCPI = mean(meanp),
            seCPI = std.error(meanp))
  
all.CTI.wtryr <- left_join(all.CTI, climate_site_wtryr, by = c("year", "site"))
all.CTI.clim <- left_join(all.CTI, climate_site, by = c("year", "site"))
```
# INTRODUCTION

These data were downloaded in another markdown file ("PRISM.rmd"). They represent the interpolated climate data at all sites for which I have community composition datasets.  

To begin, we can take a look at the monthly precipitation at each site, and compare their annual min and max temps.

```{r avg temp}
avg.temp <- all.CTI.clim %>%
  group_by(site) %>%
  summarize(avgtmin = mean(tmin),
            avgtmean = mean(tmean))
```


```{r plots, echo = FALSE}
ggplot(all.CTI.clim, aes(x = site, y = tmean)) +
  geom_boxplot()  +
  geom_jitter(aes(color = month)) +
  labs(x = "site",
       y = "mean monthly temp, 1982-2019",
       title = "Mean monthly temps at all sites")

ggplot(all.CTI.clim) +
  geom_jitter(aes(x = site, y = tmax), color = "red") +
  geom_jitter(aes(x = site, y = tmin), color = "blue") +
  labs(x = "site",
       y = "monthly min and max temps, 1982-2019",
       title = "Comparison of min and max temps at all sites")
```

Things look good - the warmest sites look warmest, and the wettest look wettest. The rain appears to be falling when logic says it would. The extra points on Carrizo and McL are due to the number of plots - this isn't summarized by plots yet.  
We're also interested in seeing how climate may or may not have changed over time - so we will generate annual summaries.  

The lines are temperature, and the bars are precip. This graph shows the data by water year (oct-sep):  

```{r annual climate, echo = FALSE}
ggplot(all.CTI.wtryr) +
  geom_point(aes(x = year, y = tmin*750, color = site), shape = 3) +
  geom_line(aes(x = year, y = tmin*750, color = site)) +
  geom_bar(aes(x = year, y = precip, color = site, fill = site), 
           stat = "identity", position = "dodge") +
  scale_y_continuous(sec.axis = sec_axis(~./750, name = "Temperature (C)")) +
  scale_x_continuous(limits = c(1980, 2020), breaks = seq(1980, 2020, 10), expand = c(0,0)) +
  labs(title = "Climate and CTI data for CA grasslands, 1982-2019",
       y = "Water Year Precipitation (mm)",
       x = "Year") +
  theme_bw() +
  theme(legend.position = "none",
        strip.background = element_blank(),
        strip.text.x = element_blank(),
        axis.text.x = element_text(hjust = 0.5, vjust = 0.5, angle = 90)) +
  facet_wrap(~site, nrow = 1)
```


# ANALYSIS
In order to have legs to stand on, we must take a look at the weather history at these sites - this means determining whether there have been directional trends in temperature or precipitation over time.  

One thing to note is that we should only look at the data over the years in which we have community composition data.  


## Precipitation Analysis
First, let's take a look at the change in precipitation over time, since I think that is less likely to be significant for our focal years. Then, we'll look at our temp. data.  

### Water year precipitation
```{r ppt prep, echo = FALSE}
# this is a quick piece of code to ensure that there's only one datapoint per year per site
all.CTI.wtryr <- all.CTI.wtryr %>%
  group_by(year, site) %>%
  summarise(precip = mean(precip),
            tmax = mean(tmax),
            tmin = mean(tmin),
            tmean = mean(tmean))

climate_site_wtryr
```

```{r precip models}
# angelo
hist(all.CTI.wtryr[all.CTI.wtryr$site == "Angelo",]$precip)
summary(lm(precip ~ year,
                    data = all.CTI.wtryr[all.CTI.wtryr$site == "Angelo",]))

# carrizo
hist(all.CTI.wtryr[all.CTI.wtryr$site == "Carrizo",]$precip)
summary(lm(precip ~ year,
                    data = all.CTI.wtryr[all.CTI.wtryr$site == "Carrizo",]))

# elkhorn
hist(all.CTI.wtryr[all.CTI.wtryr$site == "Elkhorn",]$precip)
summary(lm(precip ~ year,
                    data = all.CTI.wtryr[all.CTI.wtryr$site == "Elkhorn",]))

# jasper
hist(all.CTI.wtryr[all.CTI.wtryr$site == "Jasper",]$precip)
summary(lm(precip ~ year,
                    data = all.CTI.wtryr[all.CTI.wtryr$site == "Jasper",]))

# mcL ann
hist(all.CTI.wtryr[all.CTI.wtryr$site == "McL Ann",]$precip)
summary(lm(precip ~ year,
                    data = all.CTI.wtryr[all.CTI.wtryr$site == "McL Ann",]))

# mcL serp
hist(all.CTI.wtryr[all.CTI.wtryr$site == "McL Serp",]$precip)
summary(lm(precip ~ year,
                    data = all.CTI.wtryr[all.CTI.wtryr$site == "McL Serp",]))

# swanton
hist(all.CTI.wtryr[all.CTI.wtryr$site == "Swan",]$precip)
summary(lm(precip ~ year,
                    data = all.CTI.wtryr[all.CTI.wtryr$site == "Swan",]))

# ucsc
hist(all.CTI.wtryr[all.CTI.wtryr$site == "UCSC",]$precip)
summary(lm(precip ~ year,
                    data = all.CTI.wtryr[all.CTI.wtryr$site == "UCSC",]))


ggplot(all.CTI.wtryr, aes(x = year, y = precip, color = site)) + 
  geom_line() +
  facet_wrap(~site, ncol = 4, scales = "free")

```

## beyond data years
```{r precip models}
# angelo
hist(all.CTI.wtryr[all.CTI.wtryr$site == "Angelo",]$precip)
summary(lm(precip ~ year,
                    data = climate_site_wtryr[climate_site_wtryr$site == "Angelo",]))

# carrizo
hist(all.CTI.wtryr[all.CTI.wtryr$site == "Carrizo",]$precip)
summary(lm(precip ~ year,
                    data = climate_site_wtryr[climate_site_wtryr$site == "Carrizo",]))

# elkhorn
hist(all.CTI.wtryr[all.CTI.wtryr$site == "Elkhorn",]$precip)
summary(lm(precip ~ year,
                    data = climate_site_wtryr[climate_site_wtryr$site == "Elkhorn",]))

# jasper
hist(all.CTI.wtryr[all.CTI.wtryr$site == "Jasper",]$precip)
summary(lm(precip ~ year,
                    data = climate_site_wtryr[climate_site_wtryr$site == "Jasper",]))

# mcL ann
hist(all.CTI.wtryr[all.CTI.wtryr$site == "McL Ann",]$precip)
summary(lm(precip ~ year,
                    data = climate_site_wtryr[climate_site_wtryr$site == "McL Ann",]))

# mcL serp
hist(all.CTI.wtryr[all.CTI.wtryr$site == "McL Serp",]$precip)
summary(lm(precip ~ year,
                    data = climate_site_wtryr[climate_site_wtryr$site == "McL Serp",]))

# swanton
hist(all.CTI.wtryr[all.CTI.wtryr$site == "Swan",]$precip)
summary(lm(precip ~ year,
                    data = climate_site_wtryr[climate_site_wtryr$site == "Swanton",]))

# ucsc
hist(all.CTI.wtryr[all.CTI.wtryr$site == "UCSC",]$precip)
summary(lm(precip ~ year,
                    data = climate_site_wtryr[climate_site_wtryr$site == "UCSC",]))


ggplot(climate_site_wtryr, aes(x = year, y = precip, color = site)) + 
  geom_line() +
  facet_wrap(~site, ncol = 4, scales = "free")

```

```{r wateryear ppt graphs, echo = FALSE}
## creating significance df based on data above
wyppt.sig <- data.frame(site = c("Angelo", "Carrizo", "Elkhorn", "Jasper", "McL Ann", "McL Serp", "Swanton", "UCSC"),
                        sig = c("Yes", "No", "No", "No", "No", "No", "No", "No"))

wyppt <- left_join(all.CTI.wtryr, wyppt.sig)

#graph
ggplot(wyppt, aes(x = year, y = precip, color = site2)) +
  geom_point(shape = 3) +
  geom_line(aes(linetype = sig)) +
  labs(x = "Year",
       y = "Precip (mm)",
       title = "Water year precipitation") +
  theme_bw() +
  theme(legend.position = "left",
        strip.background = element_blank(),
        strip.text = element_blank(),
        axis.text.x = element_text(hjust = 1, vjust = 1, angle = 45),
        text = element_text(size = 14)) +
  scale_linetype_manual(values=c("dashed", "solid"))+
  facet_wrap(~site2, scales = "free", ncol = 4)
```


### Wintertime precip
So, there's pretty clearly no change in overall annual precip. However, never one to give up, I'll also check the wintertime precip (which Dr. Harrison has found is important in her models).

```{r create wintertime ppt object, include = FALSE}
# this code to reduces us to 1 data point per year per site, and gives only wintertime ppt
win.ppt <- climate_site %>%
  dplyr::select(-X) %>%
  filter(month == 12 | month == 1 | month == 2) %>%
  mutate(wyear = wtr_yr(date)) 
win.ppt <- left_join(all.CTI, win.ppt) %>%
  group_by(wyear, site, plot) %>%
  summarise(precip = sum(ppt)) %>%
  group_by(wyear, site) %>%
  summarise(wprecip = mean(precip)) %>%
  rename(year = wyear,
         precip = wprecip)
```

```{r winter precip models}
# angelo
ang.ppt <- win.ppt %>% filter(site == "Angelo")
ang.ppt.lm <- lm(precip ~ year,
                    data = ang.ppt)
summary(ang.ppt.lm)
ggplot(ang.ppt, aes(x = year, y = precip)) + geom_line()

# carrizo
car.ppt <- win.ppt %>% filter(site == "Carrizo")
car.ppt.lm <- lm(precip ~ year,
                    data = car.ppt)
summary(car.ppt.lm)
ggplot(car.ppt, aes(x = year, y = precip)) + geom_line()

# elkhorn
elk.ppt <- win.ppt %>% filter(site == "Elkhorn")
elk.ppt.lm <- lm(precip ~ year,
                    data = elk.ppt)
summary(elk.ppt.lm)
ggplot(elk.ppt, aes(x = year, y = precip)) + geom_line()

# jasper
jasp.ppt <- win.ppt %>% filter(site == "Jasper")
jasp.ppt.lm <- lm(precip ~ year,
                    data = jasp.ppt)
summary(jasp.ppt.lm)
ggplot(jasp.ppt, aes(x = year, y = precip)) + geom_line()

# mcL ann
mcLann.ppt <- win.ppt %>% filter(site == "McL Ann")
mcLann.ppt.lm <- lm(precip ~ year,
                    data = mcLann.ppt)
summary(mcLann.ppt.lm)
ggplot(mcLann.ppt, aes(x = year, y = precip)) + geom_line()

# mcL serp
mcLserp.ppt <- win.ppt %>% filter(site == "McL Serp")
mcLserp.ppt.lm <- lm(precip ~ year,
                    data = mcLserp.ppt)
summary(mcLserp.ppt.lm)
ggplot(mcLserp.ppt, aes(x = year, y = precip)) + geom_line()

# swanton
swan.ppt <- win.ppt %>% filter(site == "Swanton")
swan.ppt.lm <- lm(precip ~ year,
                    data = swan.ppt)
summary(swan.ppt.lm)
ggplot(swan.ppt, aes(x = year, y = precip)) + geom_line()


# ucsc
hist(all.CTI.wtryr[all.CTI.wtryr$site == "UCSC",]$precip)
summary(lm(precip ~ year,
                    data = all.CTI.wtryr[all.CTI.wtryr$site == "UCSC",]))
summary(ucsc.ppt.lm)
ggplot(ucsc.ppt, aes(x = year, y = precip)) + geom_line()

```

```{r winter ppt graphs, echo = FALSE}
ggplot(win.ppt, aes(x = year, y = precip, color = site)) +
  geom_point(shape = 3) +
  geom_line() +
  labs(x = "Year",
       y = "Precip (mm)",
       title = "Winter precip at all sites") +
  theme_bw() +
  theme(legend.position = "none",
        strip.background = element_blank(),
        strip.text = element_blank()) +
  facet_wrap(~site, scales = "free", nrow = 2)
```



Welp -- nothing looks significant here! Onto temperature.  

## Temperature Analysis
### Mean temp
Next, let's take a look at the minimum wintertime temperature (which I suspect may be important in cueing germination)

```{r create wintertime tmin object, include = FALSE}
# this code to reduces us to 1 data point per year per site, and gives only wintertime ppt
meanT_graphs <- climate_site %>%
  dplyr::select(-X) %>%
  mutate(wyear = wtr_yr(date)) 

meanT_graphs <- left_join(all.CTI, meanT_graphs) %>%
  group_by(year, site) %>%
  summarise(tmean = mean(tmean)) 

#graph
ggplot(meanT_graphs, aes(x = year, y = tmean, color = site)) +
  geom_point(shape = 3) +
  geom_line() +
  labs(x = "Year",
       y = "Mean temperature (C)",
       title = "Mean temperature") +
  theme_bw() +
  theme(legend.position = "left",
        strip.background = element_blank(),
        strip.text = element_blank(),
        axis.text.x = element_text(hjust = 1, vjust = 1, angle = 45),
        text = element_text(size = 14)) +
  facet_wrap(~site, scales = "free", nrow = 2)
```

```{r mean temp lms}
# angelo
hist(all.CTI.wtryr[all.CTI.wtryr$site == "Angelo",]$tmean)
summary(lm(tmean ~ year,
                    data = all.CTI.wtryr[all.CTI.wtryr$site == "Angelo",]))

# carrizo
hist(all.CTI.wtryr[all.CTI.wtryr$site == "Carrizo",]$tmean)
summary(lm(tmean ~ year,
                    data = all.CTI.wtryr[all.CTI.wtryr$site == "Carrizo",]))

# elkhorn
hist(all.CTI.wtryr[all.CTI.wtryr$site == "Elkhorn",]$tmean)
summary(lm(tmean ~ year,
                    data = all.CTI.wtryr[all.CTI.wtryr$site == "Elkhorn",]))

# jasper
hist(all.CTI.wtryr[all.CTI.wtryr$site == "Jasper",]$tmean)
summary(lm(tmean ~ year,
                    data = all.CTI.wtryr[all.CTI.wtryr$site == "Jasper",]))

# mcL ann
hist(all.CTI.wtryr[all.CTI.wtryr$site == "McL Ann",]$tmean)
summary(lm(tmean ~ year,
                    data = all.CTI.wtryr[all.CTI.wtryr$site == "McL Ann",]))

# mcL serp
hist(all.CTI.wtryr[all.CTI.wtryr$site == "McL Serp",]$tmean)
summary(lm(tmean ~ year,
                    data = all.CTI.wtryr[all.CTI.wtryr$site == "McL Serp",]))

# swanton
hist(all.CTI.wtryr[all.CTI.wtryr$site == "Swanton",]$tmean)
summary(lm(tmean ~ year,
                    data = all.CTI.wtryr[all.CTI.wtryr$site == "Swanton",]))

# ucsc
hist(all.CTI.wtryr[all.CTI.wtryr$site == "UCSC",]$tmean)
summary(lm(tmean ~ year,
                    data = all.CTI.wtryr[all.CTI.wtryr$site == "UCSC",]))



```


### Wintertime min. temp
Next, let's take a look at the minimum wintertime temperature (which I suspect may be important in cueing germination)

```{r create wintertime tmin object, include = FALSE}
# this code to reduces us to 1 data point per year per site, and gives only wintertime ppt
win.tmin <- climate_site %>%
  dplyr::select(-X) %>%
  filter(month == 12 | month == 1 | month == 2) %>%
  mutate(wyear = wtr_yr(date))

tminforgraph <- win.tmin %>%
  group_by(wyear, site) %>%
  summarise(wintmin = mean(tmin)) %>%
  rename(year = wyear)

win.tmin <- left_join(all.CTI, win.tmin) %>%
  group_by(wyear, site, plot, site2) %>%
  summarise(tmin = mean(tmin)) %>%
  group_by(wyear, site) %>%
  summarise(tmin = mean(tmin)) %>%
  rename(year = wyear)
```

```{r winter tmin models}
# angelo
hist(win.tmin[win.tmin$site == "Angelo",]$tmin)
summary(lm(tmin ~ year,
                    data = win.tmin[win.tmin$site == "Angelo",]))

# carrizo
hist(win.tmin[win.tmin$site == "Carrizo",]$tmin)
summary(lm(tmin ~ year,
                    data = win.tmin[win.tmin$site == "Carrizo",]))

# elkhorn
hist(win.tmin[win.tmin$site == "Elkhorn",]$tmin)
summary(lm(tmin ~ year,
                    data = win.tmin[win.tmin$site == "Elkhorn",]))

# jasper
jhist(win.tmin[win.tmin$site == "Jasper",]$tmin)
summary(lm(tmin ~ year,
                    data = win.tmin[win.tmin$site == "Jasper",]))

# mcL ann
hist(win.tmin[win.tmin$site == "McL Ann",]$tmin)
summary(lm(tmin ~ year,
                    data = win.tmin[win.tmin$site == "McL Ann",]))

# mcL serp
hist(win.tmin[win.tmin$site == "McL Serp",]$tmin)
summary(lm(tmin ~ year,
                    data = win.tmin[win.tmin$site == "McL Serp",]))

# swanton
hist(win.tmin[win.tmin$site == "Swanton",]$tmin)
summary(lm(tmin ~ year,
                    data = win.tmin[win.tmin$site == "Swanton",]))

# ucsc
hist(win.tmin[win.tmin$site == "UCSC",]$tmin)
summary(lm(tmin ~ year,
                    data = win.tmin[win.tmin$site == "UCSC",]))

ggplot(win.tmin, aes(x = year, y = tmin, color = site)) + 
  geom_line() +
  facet_wrap(~site, ncol = 4, scales = "free")

```

```{r winter tmin graphs, echo = FALSE}
ggplot(win.tmin, aes(x = year, y = tmin, color = site2)) +
  geom_point(shape = 3) +
  geom_line() +
  labs(x = "Year",
       y = "Temperature (C)",
       title = "Wintertime minimum temperature at all sites") +
  theme_bw() +
  theme(legend.position = "left",
        strip.background = element_blank(),
        strip.text = element_blank()) +
  facet_wrap(~site2, scales = "free", nrow = 2)
```

## Beyond Data Year Mean Temp
```{r tmean beyond models}
# angelo
summary(lm(tmean ~ year,
           data = climate_site_wtryr[climate_site_wtryr$site == "Angelo",]))

# carrizo
summary(lm(tmean ~ year,
           data = climate_site_wtryr[climate_site_wtryr$site == "Carrizo",]))

# elkhorn
summary(lm(tmean ~ year,
           data = climate_site_wtryr[climate_site_wtryr$site == "Elkhorn",]))

# jasper
summary(lm(tmean ~ year,
           data = climate_site_wtryr[climate_site_wtryr$site == "Jasper",]))

# mcL ann
summary(lm(tmean ~ year,
           data = climate_site_wtryr[climate_site_wtryr$site == "McL Ann",]))

# mcL serp
summary(lm(tmean ~ year,
           data = climate_site_wtryr[climate_site_wtryr$site == "McL Serp",]))

# swanton
summary(lm(tmean ~ year,
           data = climate_site_wtryr[climate_site_wtryr$site == "Swanton",]))

# ucsc
summary(lm(tmean ~ year,
           data = climate_site_wtryr[climate_site_wtryr$site == "UCSC",]))


ggplot(climate_site_wtryr, aes(x = year, y = tmean, color = site)) + 
  geom_line() +
  facet_wrap(~site, ncol = 4, scales = "free")

```

## Beyond Data Year Mean Temp
```{r tmin beyond models}
# angelo
summary(lm(tmin ~ year,
           data = climate_site_wtryr[climate_site_wtryr$site == "Angelo",]))

# carrizo
summary(lm(tmin ~ year,
           data = climate_site_wtryr[climate_site_wtryr$site == "Carrizo",]))

# elkhorn
summary(lm(tmin ~ year,
           data = climate_site_wtryr[climate_site_wtryr$site == "Elkhorn",]))

# jasper
summary(lm(tmin ~ year,
           data = climate_site_wtryr[climate_site_wtryr$site == "Jasper",]))

# mcL ann
summary(lm(tmin ~ year,
           data = climate_site_wtryr[climate_site_wtryr$site == "McL Ann",]))

# mcL serp
summary(lm(tmin ~ year,
           data = climate_site_wtryr[climate_site_wtryr$site == "McL Serp",]))

# swanton
summary(lm(tmin ~ year,
           data = climate_site_wtryr[climate_site_wtryr$site == "Swanton",]))

# ucsc
summary(lm(tmin ~ year,
           data = climate_site_wtryr[climate_site_wtryr$site == "UCSC",]))


ggplot(climate_site_wtryr, aes(x = year, y = tmin, color = site)) + 
  geom_line() +
  facet_wrap(~site, ncol = 4, scales = "free")

```


## lab meeting plots

```{r lab graphs}
## creating significance df
wytmin.sig <- data.frame(site = c("Angelo", "Carrizo", "Elkhorn", "Jasper", "McL Ann", "McL Serp", "Swanton", "UCSC"),
                        sig = c("No", "Yes", "Almost", "Yes", "Yes", "Yes", "No", "No"))
  

wytmin <- left_join(all.CTI.wtryr, wytmin.sig)


## creating significance df
wyppt.sig <- data.frame(site = c("Angelo", "Carrizo", "Elkhorn", "Jasper", "McL Ann", "McL Serp", "Swanton", "UCSC"),
                        wyptt.sig = c("Yes", "No", "No", "No", "No", "No", "No", "No"))

wytmin <- left_join(wytmin, wyppt.sig) 
wytmin <- wytmin %>%
dplyr::select(site, year, site2, wyptt.sig, sig, precip, tmin) %>%
  gather(precip:tmin, key = "var", value = "value")

#graph
ggplot(wytmin) +
  geom_point(aes(x = year, y = value, color = site2), shape = 3) +
  geom_line(aes(x = year, y = value, color = site2, linetype = sig)) +
  labs(x = "Year") +
  theme_bw() +
  theme(legend.position = "left",
        strip.background = element_blank(),
        axis.text.x = element_text(hjust = 1, vjust = 1, angle = 45)) +
  scale_linetype_manual(values=c("dashed", "dotted", "solid")) +
  facet_wrap(site2~var, scales = "free", nrow = 2)
```

```{r graph}
graphs.df <- left_join(all.CTI.wtryr, tminforgraph) %>%
  group_by(year, site) %>%
  summarize(tmin = mean(tmin),
            wintmin = mean(wintmin),
            tmean = mean(tmean),
            precip = mean(precip))

ggplot(graphs.df, aes(color = site)) + 
  geom_line(aes(x = year, y = tmean)) +
  geom_point(aes(x = year, y = tmean), color = "black") +
  geom_line(aes(x = year, y = tmin), linetype = 2) +
  geom_point(aes(x = year, y = tmin), color = "black") +
  geom_line(aes(x = year, y = wintmin), linetype = 3) +
  geom_point(aes(x = year, y = wintmin), color = "black") +
  geom_bar(aes(x = year, y = precip/200, fill = site, color = site, alpha = 0.01), stat = "identity") +
  labs(x = "Year",
       title = "Temp (mean, min, and winter min) and precip over time") +
  theme(legend.position = "none") +
  scale_y_continuous(name = "Mean (solid), mini (dash), and winter min (dot) annual temperature (°C)", 
                     sec.axis = sec_axis(~.*200, name = "Annual precipitation (mm)")) +
  facet_wrap(~site, ncol = 2, scales = "free")

```

