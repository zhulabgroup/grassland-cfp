---
title: "1 Study area"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{my-vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_knit$set(root.dir = here::here()) # knit from project directory
knitr::opts_chunk$set(
  collapse = TRUE,
  out.width = "100%",
  cache = T,
  comment = "#>"
)
```

```{r setup}
library(grassland)
theme_set(ggthemes::theme_few())
```

Download basemap
```{r, eval=F}
path_cfp <- down_cfp()
sf_cfp <- read_cfp(path_cfp = path_cfp)
```

```{r}
sf_cfp <- read_cfp(path_cfp = system.file("extdata","cfp", package = "grassland"))
sf_cfp %>% plot()
```

```{r, eval=F}
path_grass <- down_grasscover(sf_cfp) # need Earthdata login credentials, slow
ras_grass <- read_grasscover(path_grass = path_grass)
```

```{r}
ras_grass <- read_grasscover(path_grass = system.file("extdata", "cfp-grassland-percent-cover.tif", package = "grassland"))
ras_grass %>% terra::plot()
```

Download climate data
```{r, eval = F}
path_clim <- down_climate()
dat_clim <- read_climate(path_clim = path_clim)
```

Summarize cfp climate
```{r}
bbox_cfp <- summ_cfp_geography()
df_chelsa_cfp <- summ_cfp_climate(dat_clim, source = "chelsa")
```
CFP spans large geographic (`r bbox_cfp["xmax"] %>% abs() %>% round(0)`-`r bbox_cfp["xmin"] %>% abs() %>% round(0)`째 W longitude, `r bbox_cfp["ymin"] %>% round(0)`-`r bbox_cfp["ymax"] %>% round(0)`째 N latitude) and climatic gradients (`r df_chelsa_cfp$t_min %>% signif(digits = 3)`-`r df_chelsa_cfp$t_max %>% signif(digits = 3)` 째C temperature, `r df_chelsa_cfp$p_min %>% signif(digits = 3)`-`r df_chelsa_cfp$p_max %>% signif(digits = 3)` mm precipitation).

```{r, eval = F}
path_climate_monthly <- down_climate_monthly()
path_climate_change <- calc_climate_change(path = path_climate_monthly)
```

```{r}
df_cc_cfp <- summ_cfp_climate_change()
```

Historical climate observations show considerable warming (temperature increase by `r df_cc_cfp %>% filter(param=="tas") %>% pull(mean) %>% signif(digits = 3)` 째C yr^-1^) and drying (precipitation decrease by `r df_cc_cfp %>% filter(param=="pr") %>% pull(mean) %>% signif(digits = 3)` mm yr^-1^) from 1980 to 2019.

```{r}
gg_cfp_cc <- plot_climate_change_cfp()
```


Output figures and r data files
```{r, eval = F}
save_figure(out = list(cfp_cc = gg_cfp_cc))
save_extdata(out = list(path_cfp, path_grass))
```
