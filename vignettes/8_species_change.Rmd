---
title: "8 Species change"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{8 Species change}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_knit$set(root.dir = here::here()) # knit from project directory
knitr::opts_chunk$set(
  collapse = TRUE,
  out.width = "100%",
  cache = T,
  comment = "#>",
  fig.width = 8,
  fig.height = 8
)
```

```{r setup}
library(grassland)
theme_set(ggthemes::theme_few())
```

Analysis of species contributing to CTI CPI change
```{r, eval=F}
dat_gainloss <- calc_species_gainloss(dat_community = dat_community, dat_niche = dat_niche)
# need to output to csv
```

```{r}
gg_species_change <- plot_species_gainloss(dat_niche = dat_niche, dat_gainloss = dat_gainloss)
gg_species_change$combined
```

```{r}
df_summ_species_change_obs <- summ_species_change(dat_gainloss, option = "obs")
df_summ_species_change_exp <- summ_species_change(dat_gainloss, option = "exp")
```

Across the observations, species gained in communities by significantly increasing abundance over time (e.g., _`r df_summ_species_change_obs %>% filter(change == "increase") %>% pull(species)`_) or recruitment (appeared only after the 5th yr, e.g., _`r df_summ_species_change_obs %>% filter(change == "new") %>% pull(species)`_); in contrast, species lost from communities by significantly decreasing abundance over time (e.g., _`r df_summ_species_change_obs %>% filter(change == "decrease") %>% pull(species)`_) or extirpation (disappeared in the last 5 yr, e.g., _`r df_summ_species_change_obs %>% filter(change == "lost") %>% pull(species)`_). In the experiment, species did not experience complete turnover, but some gained by being more abundant (e.g., _`r df_summ_species_change_exp %>% filter(change == "increase") %>% pull(species)`_), while some lost by being less abundant (e.g., _`r df_summ_species_change_exp %>% filter(change == "decrease") %>% pull(species)`_) in warming compared to ambient plots.

Compare rank abundance
```{r}
dat_rank <- calc_rank_abundance(dat_community = dat_community)
gg_rank_abundance <- plot_rank_abundance(dat_rank = dat_rank)
gg_rank_abundance$obs
gg_rank_abundance$exp
```

Compare evenness
```{r}
dat_evenness <- calc_evenness(dat_community = dat_community)
test_evenness_change(dat_evenness = dat_evenness)
```

Output figures and r data files
```{r, eval = F}
save_figure(out = list(
  species_change = gg_species_change$combined,
  species_change_obs = gg_species_change$obs$circle_detail,
  species_change_exp = gg_species_change$exp$circle_detail,
  rank_abund_obs = gg_rank_abundance$obs,
  rank_abund_exp = gg_rank_abundance$exp
))
save_rda(out = list(dat_gainloss))
```
