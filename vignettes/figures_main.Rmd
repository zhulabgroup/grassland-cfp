---
title: "Main figures"
date: "`r format(Sys.time(), '%B %d, %Y')`"
editor_options: 
  chunk_output_type: console
output:
  bookdown::html_document2: 
    fig_caption: true
    number_sections: true
    global_numbering: true
  bookdown::word_document2: 
    fig_caption: true
    number_sections: true
    global_numbering: true
---

```{r setup, echo=FALSE, message=FALSE}
source("R/setup.R")
```

# Species climate niches

```{r plot_main_niche}
source("R/plot_main_niche.R")
```

We estimated species' climate niches from the GBIF occurrence data and CHELSA climate data in the California Floristic Province (CFP). In brief, we extracted the mean annual temperature and precipitation for each of the `r nrow(niche_tbl)` species with more than 100 occurrences at each of the `r format(nrow(gbif_chelsa_sf), big.mark = ",")` locations. For each species, we then calculated the average temperature and precipitation across all locations as its climate niche centroids. We visualized all the species in both the geographical space (longitude and latitude) and climate space (temperature and precipitation).

For illustration, we chose two example species: *Danthonia californica* and *Stipa pulchra*. Both are important native species in California and have abundantly distributed. *D. californica* (`r format(length(which(gbif_chelsa_sf$species_type == "cool")), big.mark = ",")` occurrences) is a northern species and prefers cool and wet climates, while *S. pulchra* (`r format(length(which(gbif_chelsa_sf$species_type == "warm")), big.mark = ",")` occurrences) is a southern species and prefers warm and dry climates. We visualized the two example species in the context of all the species.

Species distributions show clear patterns in both geographical space and climate species.

```{r, fig.width=7.5, fig.height=7.5*1.168, fig.cap="Grassland species occur along geographic and climatic gradients to estimate ecological niches. (A) Occurrence of grassland species in the California Floristic Province, retrieved from the GBIF data (*n* = 824,478 records, gray points), highlighting two example species *Danthonia californica* in the north (*n* = 916 records, blue points) and *Stipa pulchra* in the south (*n* = 3,087 records, red points). (B) Species occurrence in climate space of mean annual temperature (°C) and annual precipitation (mm), retrieved from the CHELSA data (gray), highlighting the same two example species *Danthonia californica* under cool and wet climates (blue) and *Stipa pulchra* under warm and dry climates (red). (C) Ecological niche estimates from average temperature and precipitation for each species (*n* = 372 species, mean ± standard error, gray), highlighting the two species (blue and red)."}
niche_gg
rm(list = setdiff(ls(), "path_ls"))
```

# Experimental community shifts

```{r plot_main_exp}
source("R/plot_main_exp.R")
```

JRGCE warming experment to CTI and CPI comparisons. Read in niche and experimental data. Side-by-side boxplots to compare CTI and CPI from ambient vs. warming treatments.

```{r, fig.width=10, fig.height=6.18, fig.cap="Grassland community shifts from long-term experiments. Warming treatment causes communities to shift dominance to warmer (CTI, °C) and drier (CPI, mm) species in the Jasper Ridge Global Change Experiment (*n* = 200 plots, with 136 ambient plots in black, 64 warming plots in red, 1998 pre-treatment year, non-parametric two-sample Wilcoxon test, ns: *p* > 0.05, $*$: *p* ≤ 0.05, $**$: *p* ≤ 0.01, $***$: *p* ≤ 0.001). "}
exp_gg
rm(list = setdiff(ls(), "path_ls"))
```

# Observational community shifts

```{r plot_main_obs}
source("R/plot_main_obs.R")
```

Observational data CTI and CPI comparisons, arranged by observational sites.
Render and save.

```{r, fig.width=10, fig.height=10*1.618, fig.cap="Grassland community shifts from long-term observations. (A to K) Consistent with climate warming and drying, grassland communities shift dominance to warmer (CTI) and drier (CPI) species in 11 long-term observational sites across the California Floristic Province (red trend lines by linear regression, significant slopes by *t*-test, *p* < 0.05)."}
obs_gg
rm(list = setdiff(ls(), "path_ls"))
```
