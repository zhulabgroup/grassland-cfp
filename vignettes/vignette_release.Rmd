---
title: "Vignette_release"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette_release}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_knit$set(root.dir = here::here()) # knit from project directory
knitr::opts_chunk$set(
  collapse = TRUE,
  out.width = "100%",
  fig.width = 10,
  fig.height = 10,
  cache = T,
  comment = "#>"
)
```

```{r setup}
library(grassland)
theme_set(ggthemes::theme_few())
```

Load community composition data (experimental and observational).
```{r}
dat_final_community <- read_community(version = "final")
dat_final_community
```

```{r}
cfp_sf <- read_cfp ()
grass_ras <- read_grasscover ()
```

```{r}
# spp_tbl <- consolidate_species(dat_community=dat_final_community)
dat_occ <- load_occurrence()
dat_occ
dat_clim <- load_climate ()
dat_clim
```

Calculate species niche and plot
```{r}
dat_trait <- load_individual_trait()
dat_niche <- summarize_species_niche(dat_trait, add_dummy = T)

cool_sp_niche_gg <- plot_ind_sp_niche(dat_occ, dat_trait, cfp_sf, sp = "Danthonia californica")
warm_sp_niche_gg <- plot_ind_sp_niche(dat_occ, dat_trait, cfp_sf, sp = "Stipa pulchra")
cool_sp_niche_gg
warm_sp_niche_gg

sp_niche_gg <- plot_sp_niche(dat_niche,
  cool_species = "Danthonia californica",
  warm_species = "Stipa pulchra"
)
sp_niche_gg
```

Calculate CTI CPI in observations and experiments and plot

```{r}
dat_index <- calculate_community_index(dat_niche= dat_niche, dat_community=dat_final_community)
obs_comm_gg<- plot_comm_index (option = "obs", dat_index = dat_index,cfp_sf, grass_ras )
obs_comm_gg
exp_comm_gg<- plot_comm_index (option = "exp", dat_index = dat_index)
exp_comm_gg
```

Synthesize coupled CTI CPI change
```{r}
dat_shift <- calc_community_shift(dat_index = dat_index)
comm_shift_gg <- plot_community_shift(dat_shift, dat_niche)
comm_shift_gg$obs
comm_shift_gg$exp
comm_shift_gg$compare
```

Analysis of species contributing to CTI CPI change
```{r}
species_change_gg <- plot_species_gainloss(dat_niche=dat_niche)
species_change_gg$obs$circle_detail
species_change_gg$exp$circle_detail
```
